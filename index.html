<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Psicometr√≠a II ¬∑ Plataforma Interactiva</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Estilos principales -->
    <style>
        /* =====================
           RESET & GLOBAL STYLES
           ===================== */
        body {
            font-family: system-ui, sans-serif;
            background: #f4f6fb;
            color: #1f2937;
            margin: 0;
            padding: 0;
        }

        h1, h2, h3 {
            font-weight: 700;
            color: #1e293b;
        }

        .section-container {
            margin: 40px auto;
            padding: 20px;
            max-width: 900px;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.05);
        }

        .btn-primary {
            background: #4f46e5;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            display: inline-block;
            transition: 0.2s;
        }
        .btn-primary:hover {
            background: #4338ca;
        }

        /* ============
           VIDEO PLAYER
           ============ */
        .video-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .video-title {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 12px;
        }

        /* ============
           FLASHCARDS
           ============ */
        .flashcard {
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: transform 0.25s;
        }
        .flashcard:hover {
            transform: scale(1.02);
        }

        /* ========
           QUIZ
           ======== */
        .quiz-option {
            padding: 16px;
            background: white;
            border-radius: 10px;
            border: 2px solid #e5e7eb;
            margin-bottom: 12px;
            cursor: pointer;
            transition: 0.2s;
        }
        .quiz-option:hover {
            background: #eef2ff;
        }
        .quiz-option.selected {
            border-color: #4338ca;
            background: #eef2ff;
        }

        /* =====================
           FILL IN THE BLANK
           ===================== */
        .fill-input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 5px;
        }

        /* ======================
           DRAG & DROP ASSOCIATION
           ====================== */
        .association-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }

        .assoc-item {
            background: #4361ee;
            color: white;
            padding: 12px;
            margin: 5px 0;
            border-radius: 5px;
            cursor: move;
        }

        .assoc-target {
            min-height: 50px;
            border: 2px dashed #ddd;
            margin: 5px 0;
            border-radius: 5px;
            display: flex;
            align-items: center;
            padding: 10px;
            background: #f9f9f9;
        }

        /* ======================
           QUESTION TYPE TAG
           ====================== */
        .question-type-indicator {
            background: #e3f2fd;
            color: #1976d2;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.85em;
            margin: 10px 0;
            display: inline-block;
        }

        /* ============
           NOTEBOOK LM
           ============ */
        .notebook-links-container {
            display: none;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #4361ee;
        }

        .notebook-link-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>

<!-- ======================
     HEADER / NAVIGATION
======================= -->
<header class="bg-white shadow-md sticky top-0 z-50">
    <div class="max-w-6xl mx-auto flex justify-between items-center p-4">
        <h1 class="text-2xl font-bold text-indigo-600">Psicometr√≠a II ¬∑ Plataforma Interactiva</h1>
        <nav class="space-x-6 text-gray-700 font-medium hidden md:block">
            <a href="#landing" class="hover:text-indigo-600">Inicio</a>
            <a href="#videos" class="hover:text-indigo-600">Videos</a>
            <a href="#flashcards" class="hover:text-indigo-600">Flashcards</a>
            <a href="#quiz" class="hover:text-indigo-600">Cuestionario</a>
            <a href="#exam" class="hover:text-indigo-600">Examen</a>
            <a href="#dashboard" class="hover:text-indigo-600">Dashboard</a>
        </nav>
    </div>
</header>

<!-- ======================
     LANDING SECTION
======================= -->
<section id="landing" class="py-16">
    <div class="max-w-5xl mx-auto text-center">
        <div class="hero-gradient opacity-0 transition-all duration-700 transform translate-y-6">
            <h2 class="text-4xl font-extrabold mb-4">
                Bienvenido a la Plataforma de Psicometr√≠a II
            </h2>
            <p class="text-lg text-gray-600 mb-8">
                Un ecosistema interactivo para aprender, practicar y dominar los 
                fundamentos de las principales teor√≠as de medici√≥n psicol√≥gica.
            </p>
            <a href="#videos" class="btn-primary text-lg">Comenzar ahora</a>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-16">
            <div class="portal-card glass-card opacity-0">
                <h3 class="text-xl font-bold mb-2">üì∫ Clases por video</h3>
                <p class="text-gray-600">Explicaciones claras, actualizadas y organizadas por m√≥dulos tem√°ticos.</p>
            </div>

            <div class="portal-card glass-card opacity-0">
                <h3 class="text-xl font-bold mb-2">üß† Flashcards inteligentes</h3>
                <p class="text-gray-600">Memoriza conceptos clave con tarjetas interactivas.</p>
            </div>

            <div class="portal-card glass-card opacity-0">
                <h3 class="text-xl font-bold mb-2">üìù Ex√°menes y cuestionarios</h3>
                <p class="text-gray-600">Pon a prueba tus conocimientos con retroalimentaci√≥n inmediata.</p>
            </div>
        </div>
    </div>
</section>

<!-- ======================
     VIDEO SECTION
======================= -->
<section id="videos" class="section-container">
    <h2 class="text-3xl font-bold mb-6">üì∫ Clases por Video</h2>

    <!-- Video Player -->
    <div class="video-container mb-8">
        <h3 id="video-title" class="video-title">Selecciona un video para comenzar</h3>
        <iframe 
            id="video-frame"
            class="w-full rounded-lg shadow-lg"
            height="450"
            src=""
            allowfullscreen>
        </iframe>
    </div>

    <!-- Video List -->
    <div id="video-list" class="grid md:grid-cols-2 gap-6">
        <!-- Generado din√°micamente por JS -->
    </div>

    <!-- Humor previo al video -->
    <div id="prevideo-humor" class="mt-8"></div>
</section>

<!-- ========================================
     NOTEBOOK LM RESOURCES (INSERTADO AQU√ç)
========================================= -->
<div class="section-container">
    <h3 class="text-2xl font-bold mb-4">üìö Recursos NotebookLM</h3>
    <div id="notebook-links-container" class="notebook-links-container">
        <p style="color:#666; text-align:center; padding:20px;">
            Cargando recursos adicionales...
        </p>
    </div>
</div>

<!-- ======================
     FLASHCARDS SECTION
======================= -->
<section id="flashcards" class="section-container">
    <h2 class="text-3xl font-bold mb-6">üß† Flashcards Interactivas</h2>

    <div class="mb-4">
        <label for="deck-selector" class="font-medium">Selecciona un m√≥dulo:</label>
        <select id="deck-selector" class="ml-2 p-2 border rounded">
            <option value="">-- Selecciona un tema --</option>
            <!-- Cargado din√°micamente -->
        </select>
    </div>

    <div id="flashcard-box" class="glass-card text-center p-10 text-xl font-semibold cursor-pointer">
        Haz clic para comenzar
    </div>

    <!-- Mini Caso -->
    <div id="mini-caso" class="mt-10"></div>
</section>

<!-- ======================
     QUIZ SECTION
======================= -->
<section id="quiz" class="section-container">
    <h2 class="text-3xl font-bold mb-6">üìù Cuestionario por M√≥dulos</h2>

    <!-- Selecci√≥n de m√≥dulo -->
    <div class="mb-4">
        <label for="quiz-topic-selector" class="font-medium">Selecciona un m√≥dulo:</label>
        <select id="quiz-topic-selector" class="ml-2 p-2 border rounded">
            <option value="">-- Selecciona un tema --</option>
            <!-- Cargado por JS -->
        </select>
    </div>

    <!-- Contenedor general del quiz -->
    <div id="quiz-container" class="glass-card p-6 hidden">

        <!-- T√≠tulo del √≠tem -->
        <div class="flex justify-between items-center mb-4">
            <span id="quiz-topic-name" class="text-lg font-semibold"></span>
            <span id="quiz-progress" class="text-sm text-gray-500"></span>
        </div>

        <!-- Tipo de pregunta -->
        <div id="quiz-question-type" class="question-type-indicator hidden"></div>

        <!-- Enunciado -->
        <h3 id="quiz-question-text" class="text-xl font-bold mb-4"></h3>

        <!-- Contenedor para opciones -->
        <div id="quiz-options"></div>

        <!-- Contenedor input fill-in-the-blank -->
        <div id="quiz-fill-container" class="hidden">
            <input 
                id="quiz-fill-input" 
                class="fill-input" 
                type="text" 
                placeholder="Escribe tu respuesta aqu√≠..." />
        </div>

        <!-- Contenedor asociaci√≥n -->
        <div id="quiz-association-container" class="association-container hidden">
            <div>
                <h4 class="font-medium mb-2">Conceptos</h4>
                <div id="assoc-items"></div>
            </div>

            <div>
                <h4 class="font-medium mb-2">Respuestas</h4>
                <div id="assoc-targets"></div>
            </div>
        </div>

        <!-- Feedback -->
        <div id="feedback-container" class="hidden mt-6">
            <div id="feedback-message" class="text-lg font-bold mb-2"></div>
            <div id="feedback-explanation" class="text-gray-700"></div>
        </div>

        <!-- Controles -->
        <div class="flex justify-between mt-8">
            <button 
                id="previous-question-btn" 
                class="btn-primary bg-gray-500 hover:bg-gray-600"
                onclick="previousQuestion()">
                ‚Üê Anterior
            </button>

            <div class="space-x-3">
                <button 
                    id="submit-btn" 
                    class="btn-primary"
                    onclick="submitAnswer()">
                    Responder
                </button>

                <button 
                    id="next-btn" 
                    class="btn-primary hidden"
                    onclick="nextQuestion()">
                    Siguiente ‚Üí
                </button>
            </div>
        </div>
    </div>
</section>

<!-- ======================
     DASHBOARD SECTION
======================= -->
<section id="dashboard" class="section-container">
    <h2 class="text-3xl font-bold mb-6">üìä Dashboard de Progreso</h2>

    <div class="grid md:grid-cols-3 gap-8">

        <!-- D√≠as de estudio -->
        <div class="glass-card p-6 text-center">
            <h3 class="text-xl font-semibold mb-2">D√≠as de estudio</h3>
            <p id="study-days" class="text-4xl font-bold text-indigo-600">0</p>
        </div>

        <!-- Racha -->
        <div class="glass-card p-6 text-center">
            <h3 class="text-xl font-semibold mb-2">Racha actual</h3>
            <p id="current-streak" class="text-4xl font-bold text-indigo-600">0</p>
        </div>

        <!-- Dominio general -->
        <div class="glass-card p-6 text-center">
            <h3 class="text-xl font-semibold mb-2">Dominio general</h3>
            <p id="overall-mastery" class="text-4xl font-bold text-indigo-600">0%</p>
        </div>
    </div>

    <!-- Progreso por m√≥dulos -->
    <div class="mt-10">
        <h3 class="text-xl font-bold mb-4">Progreso por Tema</h3>
        <div id="module-progress" class="space-y-4">
            <!-- Generado din√°micamente -->
        </div>
    </div>
</section>

<!-- ======================
     EXAM SECTION
======================= -->
<section id="exam" class="section-container">
    <h2 class="text-3xl font-bold mb-6">üß™ Examen Final (50 preguntas)</h2>

    <!-- ======================
         EXAM START SCREEN
    ======================= -->
    <div id="exam-start" class="glass-card p-6">
        <p class="text-gray-700 mb-4">
            Este examen simulado contiene <strong>50 preguntas aleatorias</strong> 
            provenientes de todos los m√≥dulos. Tienes un m√°ximo de 
            <strong>60 minutos</strong> para completarlo.
        </p>

        <!-- Distribuci√≥n del examen por temas -->
        <div id="exam-distribution" class="mt-6 space-y-2 text-sm text-gray-700">
            <!-- Llenado din√°micamente por initializeExam() -->
        </div>

        <button 
            onclick="startExam()" 
            class="btn-primary text-lg mt-6">
            Comenzar Examen ‚Üí
        </button>
    </div>

    <!-- ======================
         EXAM ACTIVE SCREEN
    ======================= -->
    <div id="exam-active" class="hidden">

        <!-- Timer -->
        <div class="flex justify-between items-center mb-6">
            <div class="text-lg font-medium">
                Pregunta <span id="exam-question-number">1</span> / 50
            </div>

            <div class="text-red-600 font-bold text-xl">
                ‚è≥ <span id="exam-timer">60:00</span>
            </div>
        </div>

        <!-- Barra de progreso -->
        <div class="w-full bg-gray-200 rounded-full h-3 mb-6">
            <div 
                id="exam-progress" 
                class="bg-indigo-600 h-3 rounded-full" 
                style="width: 0%;">
            </div>
        </div>

        <!-- Question Icon -->
        <div class="text-4xl mb-2 text-center" id="exam-question-icon">üß†</div>

        <!-- Question Text -->
        <h3 id="exam-question-text" class="text-xl font-bold mb-6 text-center"></h3>

        <!-- Options -->
        <div id="exam-options" class="space-y-4">
            <!-- Generado din√°micamente -->
        </div>

        <!-- Buttons -->
        <div class="flex justify-center mt-8">
            <button 
                onclick="submitExamAnswer()" 
                id="exam-submit-btn"
                class="btn-primary text-lg">
                Responder ‚Üí
            </button>
        </div>
    </div>

    <!-- ======================
         EXAM RESULTS SCREEN
    ======================= -->
    <div id="exam-results" class="hidden glass-card p-8 mt-10 text-center">

        <h3 class="text-3xl font-bold mb-4">Resultados del Examen</h3>

        <div class="text-6xl font-extrabold text-indigo-600 mb-6" id="exam-final-score">
            0%
        </div>

        <p class="text-gray-700 text-lg mb-1">
            Tiempo utilizado:
            <strong id="exam-time-used">00:00</strong>
        </p>

        <p class="text-gray-700 text-lg mb-6">
            Intentos realizados: 
            <strong id="exam-attempts-count">‚Äî</strong>
        </p>

        <h4 class="text-xl font-bold mt-10 mb-4">Desglose por Temas</h4>

        <div id="exam-breakdown" class="space-y-3 max-w-xl mx-auto">
            <!-- Generado din√°micamente -->
        </div>

        <div class="mt-10 flex justify-center space-x-4">
            <button 
                onclick="restartExam()" 
                class="btn-primary">
                Reiniciar Examen
            </button>

            <a href="#landing" class="btn-primary bg-gray-500 hover:bg-gray-600">
                Volver al Inicio
            </a>
        </div>
    </div>
</section>

<!-- ======================
     NOTES SECTION
======================= -->
<section id="notes" class="section-container">
    <h2 class="text-3xl font-bold mb-6">üóíÔ∏è Notas del Estudiante</h2>

    <p class="text-gray-600 mb-4">
        Escribe tus reflexiones personales, res√∫menes o ideas clave mientras estudias
        los m√≥dulos. Estas notas se guardar√°n autom√°ticamente en tu navegador.
    </p>

    <textarea 
        id="student-notes" 
        class="w-full h-48 p-4 border rounded-lg shadow focus:outline-none focus:ring focus:border-indigo-500"
        placeholder="Escribe tus notas aqu√≠..."></textarea>
</section>

<!-- ======================
     NOTEBOOK LM (JS Render)
======================= -->
<section id="notebooklm" class="section-container">
    <!-- Esta secci√≥n se llena din√°micamente por renderNotebookLMSection() -->
</section>

<!-- ======================
     NAVIGATION FOOTER
======================= -->
<footer class="py-10 text-center text-gray-600">
    <p class="mb-2">¬© 2025 Psicometr√≠a II ¬∑ Plataforma Interactiva</p>
    <p class="text-sm">
        Desarrollado para uso acad√©mico en la Facultad de Filosof√≠a ‚Äì UNA.
    </p>
</footer>

<!-- ======================
     SCRIPTS PRINCIPALES
======================= -->

<!-- Core Scripts -->
<script src="./platform.js"></script>
<script src="./assets/js/main.js"></script>

<!-- Humor & MiniCasos Scripts -->
<script type="module">
    import { showHumor } from './assets/js/humor.js';
    import { renderMiniCaso } from './assets/js/minicaso.js';

    const videoUnitMap = {
        'teoria_medicion': 'teoria_medicion',
        'teoria_escalamiento': 'teoria_escalamiento',
        'esc_psicologico': 'esc_psicologico',
        'thurstone': 'thurstone',
        'likert': 'likert',
        'guttman': 'guttman',
        'tct': 'tct',
        'confiabilidad': 'confiabilidad',
        'validez': 'validez',
        'factorial': 'factorial',
        'baremacion': 'baremacion',
        'tri': 'tri'
    };

    const humorMount = '#prevideo-humor';
    const miniCasoMount = '#mini-caso';

    /* ================================
       HUMOR AUTOM√ÅTICO SEG√öN EL VIDEO
       ================================ */
    const showHumorForVideo = (videoId) => {
        const slug = videoUnitMap[videoId] || 'tct';
        showHumor(slug, humorMount);
    };

    /* ================================
       MINI CASO AUTOM√ÅTICO SEG√öN DECK
       ================================ */
    const clearMiniCaso = () => {
        const mount = document.querySelector(miniCasoMount);
        if (mount) mount.innerHTML = '';
    };

    const renderMiniCasoForDeck = (slug) => {
        if (!slug) return clearMiniCaso();
        renderMiniCaso(slug, miniCasoMount);
    };

    /* ================================
       OVERRIDE DE FUNCIONES GLOBALES
       ================================ */
    const originalChangeVideo = window.changeVideo;
    window.changeVideo = function(videoId, title) {
        if (typeof originalChangeVideo === 'function') {
            originalChangeVideo.apply(this, arguments);
        }
        showHumorForVideo(videoId);
    };

    const originalChangeDeck = window.changeDeck;
    window.changeDeck = function() {
        if (typeof originalChangeDeck === 'function') {
            originalChangeDeck.apply(this, arguments);
        }
        const selector = document.getElementById('deck-selector');
        renderMiniCasoForDeck(selector ? selector.value : '');
    };

    /* ================================
       AUTO-CARGA EN EL INICIO
       ================================ */
    document.addEventListener('DOMContentLoaded', () => {

        const savedProgress = JSON.parse(localStorage.getItem('studyProgress') || '{}');

        // Humor seg√∫n √∫ltimo video visto
        const videoId = savedProgress.lastVideoId;
        if (videoId) showHumorForVideo(videoId);

        // Mini caso seg√∫n √∫ltimo deck usado
        const selector = document.getElementById('deck-selector');
        if (selector && selector.value) {
            renderMiniCasoForDeck(selector.value);
        } else {
            clearMiniCaso();
        }

        // Render NotebookLM cards si existe la secci√≥n
        if (document.getElementById('notebooklm')) {
            if (typeof renderNotebookLMSection === "function") {
                renderNotebookLMSection();
            }
        }
    });
</script>

<script>
/* ==========================================================
   NOTEBOOK LM ‚Äì RENDER DIN√ÅMICO
========================================================== */
async function renderNotebookLMSection() {
    const root = document.getElementById('notebooklm');
    if (!root) return;

    const description =
        'NotebookLM es un entorno de estudio de Google con materiales curados por tema. ' +
        'Cada notebook funciona como un mini-centro de aprendizaje para profundizar antes del cuestionario ' +
        'o cuando necesites repasar con m√°s contexto.';

    root.innerHTML = `
        <div class="py-12">
            <h2 class="text-3xl font-bold mb-4 text-center md:text-left">Material ampliado (NotebookLM)</h2>
            <p class="text-gray-600 max-w-3xl mb-6">${description}</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="notebooklm-grid"></div>
        </div>
    `;

    const grid = root.querySelector('#notebooklm-grid');

    try {
        const response = await fetch('resources/notebooklm-links.json', { cache: 'no-store' });
        if (!response.ok) throw new Error('No se pudo cargar');

        const data = await response.json();

        data.forEach(item => {
            const card = document.createElement('div');
            card.className = 'notebook-link-card';

            card.innerHTML = `
                <h3 class="text-xl font-semibold mb-2">${item.titulo}</h3>
                <p class="text-gray-600 text-sm mb-3">${item.descripcion || ''}</p>
                <a class="btn-primary inline-block text-center" target="_blank" rel="noopener"
                   href="${item.url}">
                   Abrir Notebook
                </a>
            `;

            grid.appendChild(card);
        });

    } catch (error) {
        console.error('Error al cargar NotebookLM:', error);
        root.innerHTML =
            '<div class="json-error">No fue posible cargar los enlaces de NotebookLM en este momento.</div>';
    }
}

/* ==========================================================
   ANIMACI√ìN DE ENTRADA ‚Äì LANDING PAGE
========================================================== */
function loadLandingPage() {
    setTimeout(() => {
        const hero = document.querySelector('#landing .hero-gradient');
        if (hero) {
            hero.style.opacity = '0';
            hero.style.transform = 'translateY(30px)';
            requestAnimationFrame(() => {
                hero.style.transition = 'all 0.6s ease';
                hero.style.opacity = '1';
                hero.style.transform = 'translateY(0)';
            });
        }

        const elements = document.querySelectorAll('#landing .portal-card, #landing .glass-card');
        elements.forEach((el, index) => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(24px)';

            setTimeout(() => {
                el.style.transition = 'all 0.6s ease';
                el.style.opacity = '1';
                el.style.transform = 'translateY(0)';
            }, index * 120);
        });
    }, 100);
}

// Inicializaci√≥n general
document.addEventListener('DOMContentLoaded', () => {
    loadLandingPage();
});
</script>

</body>
</html>
