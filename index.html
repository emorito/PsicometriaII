<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psicometría Aplicada II - Plataforma Educativa</title>
    
    <!-- Fuentes premium -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <!-- Bibliotecas para efectos visuales -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.12/typed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanta/0.5.24/vanta.net.min.js"></script>
    
    <!-- YouTube API -->
    <script src="https://www.youtube.com/iframe_api"></script>
    
    <!-- Estilos mejorados -->
    <style>
        /* ---------- VARIABLES DE DISEÑO EDITORIAL ---------- */
        :root {
            /* Colores principales - palette sofisticada */
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --info-color: #3498db;
            --danger-color: #e74c3c;
            
            /* Colores de fondo */
            --bg-primary: #fafafa;
            --bg-secondary: #f8f9fa;
            --bg-card: #ffffff;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            
            /* Colores de texto */
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --text-muted: #95a5a6;
            
            /* Fuentes */
            --font-display: 'Playfair Display', serif;
            --font-body: 'Inter', sans-serif;
            
            /* Espaciado */
            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;
            --spacing-xxl: 4rem;
            
            /* Sombras y efectos */
            --shadow-sm: 0 2px 10px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 8px 30px rgba(0, 0, 0, 0.12);
            --shadow-lg: 0 15px 35px rgba(0, 0, 0, 0.15);
            
            /* Transiciones */
            --transition-fast: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Bordes */
            --border-radius: 16px;
            --border-radius-sm: 8px;
            --border-radius-lg: 24px;
        }

        /* Modo oscuro */
        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-card: #252525;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --text-muted: #808080;
            --shadow-sm: 0 2px 10px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 8px 30px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 15px 35px rgba(0, 0, 0, 0.5);
        }

        /* ---------- RESET Y ESTILOS BASE ---------- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-body);
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            transition: var(--transition-normal);
        }

        /* ---------- FONDO ANIMADO ---------- */
        #vanta-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.05;
        }

        /* ---------- NAVEGACIÓN PRINCIPAL ---------- */
        .main-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--bg-card);
            box-shadow: var(--shadow-sm);
            z-index: 1000;
            padding: var(--spacing-md) 0;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 var(--spacing-lg);
        }

        .logo {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .nav-links {
            display: flex;
            gap: var(--spacing-lg);
            align-items: center;
        }

        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition-normal);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius-sm);
        }

        .nav-link:hover {
            color: var(--accent-color);
            background: var(--bg-secondary);
        }

        .nav-link.active {
            color: var(--accent-color);
            background: var(--bg-secondary);
        }

        /* ---------- CONTENEDOR PRINCIPAL ---------- */
        .main-container {
            margin-top: 80px;
            min-height: calc(100vh - 80px);
            padding: var(--spacing-xl);
        }

        .content-wrapper {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ---------- PANTALLA DE BIENVENIDA ---------- */
        .welcome-screen {
            text-align: center;
            padding: var(--spacing-xxl) 0;
        }

        .hero-section {
            margin-bottom: var(--spacing-xxl);
        }

        .hero-title {
            font-family: var(--font-display);
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 800;
            margin-bottom: var(--spacing-lg);
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto var(--spacing-xl);
            line-height: 1.8;
        }

        /* ---------- TARJETAS DE UNIDADES ---------- */
        .units-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: var(--spacing-xl);
            margin-top: var(--spacing-xxl);
        }

        .unit-card {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-md);
            transition: var(--transition-normal);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
        }

        .unit-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: var(--transition-slow);
        }

        .unit-card:hover::before {
            left: 100%;
        }

        .unit-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
            border-color: var(--accent-color);
        }

        .unit-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-lg);
            display: block;
            color: var(--accent-color);
        }

        .unit-title {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: var(--spacing-md);
            color: var(--primary-color);
        }

        .unit-description {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-lg);
            line-height: 1.6;
        }

        .unit-progress {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
        }

        .progress-bar-container {
            flex: 1;
            height: 8px;
            background: var(--bg-secondary);
            border-radius: 4px;
            margin-right: var(--spacing-md);
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), var(--info-color));
            border-radius: 4px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .progress-text {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
            min-width: 50px;
        }

        .unit-actions {
            display: flex;
            gap: var(--spacing-md);
        }

        .action-btn {
            flex: 1;
            padding: var(--spacing-md);
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--info-color));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 2px solid var(--text-muted);
        }

        .btn-secondary:hover {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        /* ---------- PANTALLA DE UNIDAD ---------- */
        .unit-screen {
            display: none;
        }

        .unit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xl);
            padding: var(--spacing-lg);
            background: var(--bg-card);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
        }

        .unit-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .unit-icon-large {
            font-size: 3rem;
            color: var(--accent-color);
        }

        .unit-details h1 {
            font-family: var(--font-display);
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: var(--spacing-xs);
        }

        .unit-details p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .back-btn {
            background: var(--text-muted);
            color: white;
            border: none;
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-normal);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .back-btn:hover {
            background: var(--text-secondary);
            transform: translateY(-2px);
        }

        /* ---------- SECCIONES DE CONTENIDO ---------- */
        .content-sections {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }

        .video-section {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-md);
        }

        .video-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            margin-bottom: var(--spacing-lg);
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: var(--border-radius-sm);
        }

        .video-controls {
            display: flex;
            justify-content: center;
            gap: var(--spacing-md);
        }

        .video-btn {
            padding: var(--spacing-sm) var(--spacing-lg);
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-normal);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        /* ---------- PANEL LATERAL ---------- */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        .flashcard-section, .quiz-section {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-md);
        }

        .section-title {
            font-family: var(--font-display);
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: var(--spacing-lg);
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        /* ---------- FLASHCARDS ---------- */
        .flashcard-container {
            perspective: 1000px;
            margin-bottom: var(--spacing-lg);
        }

        .flashcard {
            width: 100%;
            height: 200px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }

        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .flashcard-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-lg);
            text-align: center;
            box-shadow: var(--shadow-sm);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .flashcard-front {
            background: linear-gradient(135deg, var(--info-color), var(--primary-color));
            color: white;
        }

        .flashcard-back {
            background: var(--bg-secondary);
            color: var(--text-primary);
            transform: rotateY(180deg);
            border: 2px solid var(--accent-color);
        }

        .flashcard-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: var(--spacing-md);
        }

        .flashcard-counter {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* ---------- QUICK QUIZ ---------- */
        .quiz-preview {
            text-align: center;
            margin-bottom: var(--spacing-lg);
        }

        .quiz-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .stat-item {
            text-align: center;
            padding: var(--spacing-md);
            background: var(--bg-secondary);
            border-radius: var(--border-radius-sm);
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--accent-color);
            display: block;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ---------- RESPONSIVE ---------- */
        @media (max-width: 768px) {
            .content-sections {
                grid-template-columns: 1fr;
            }
            
            .units-grid {
                grid-template-columns: 1fr;
            }
            
            .unit-actions {
                flex-direction: column;
            }
            
            .nav-links {
                display: none;
            }
        }

        /* ---------- ANIMACIONES ---------- */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }

        /* ---------- EFECTOS DE SCROLL ---------- */
        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.6s ease-out;
        }

        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* ---------- UTILIDADES ---------- */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mb-lg {
            margin-bottom: var(--spacing-lg);
        }

        .mb-xl {
            margin-bottom: var(--spacing-xl);
        }

        /* ---------- MEJORAS EDUCATIVAS ---------- */
        .learning-progress {
            position: fixed;
            top: 80px;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--bg-secondary);
            z-index: 999;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), var(--info-color));
            transition: width 0.3s ease;
            width: 0%;
        }

        .achievement-badge {
            position: fixed;
            top: 120px;
            right: 20px;
            background: var(--bg-card);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            box-shadow: var(--shadow-lg);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1001;
        }

        .achievement-badge.show {
            transform: translateX(0);
        }

        .study-timer {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--bg-card);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            box-shadow: var(--shadow-lg);
            z-index: 1001;
        }

        .timer-display {
            font-family: var(--font-display);
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-color);
        }

        .difficulty-indicator {
            display: flex;
            gap: 2px;
            margin-top: var(--spacing-sm);
        }

        .difficulty-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-muted);
        }

        .difficulty-dot.active {
            background: var(--warning-color);
        }

        .difficulty-dot.medium {
            background: var(--info-color);
        }

        .difficulty-dot.hard {
            background: var(--danger-color);
        }
    </style>
</head>
<body>
    <!-- Fondo animado -->
    <div id="vanta-bg"></div>
    
    <!-- Barra de progreso de aprendizaje -->
    <div class="learning-progress">
        <div class="progress-fill" id="progress-fill"></div>
    </div>
    
    <!-- Navegación principal -->
    <nav class="main-nav">
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-brain"></i>
                Psicometría II
            </div>
            <div class="nav-links">
                <a href="#" class="nav-link active" data-section="home">
                    <i class="fas fa-home"></i> Inicio
                </a>
                <a href="#" class="nav-link" data-section="dashboard">
                    <i class="fas fa-chart-bar"></i> Progreso
                </a>
                <a href="#" class="nav-link" data-section="exam">
                    <i class="fas fa-graduation-cap"></i> Examen Final
                </a>
                <a href="#" class="nav-link" data-section="settings">
                    <i class="fas fa-cog"></i> Ajustes
                </a>
            </div>
        </div>
    </nav>
    
    <!-- Contenedor principal -->
    <div class="main-container">
        <div class="content-wrapper">
            
            <!-- Pantalla de bienvenida -->
            <div id="welcome-screen" class="welcome-screen">
                <div class="hero-section fade-in">
                    <h1 class="hero-title" id="hero-title">Plataforma de Estudio</h1>
                    <p class="hero-subtitle" id="hero-subtitle">
                        Domina la Psicometría Aplicada II con videos explicativos, 
                        flashcards interactivas y cuestionarios de práctica.
                    </p>
                </div>
                
                <!-- Unidades de estudio -->
                <div class="units-grid" id="units-grid">
                    <!-- Las unidades se generarán dinámicamente -->
                </div>
            </div>
            
            <!-- Pantalla de unidad específica -->
            <div id="unit-screen" class="unit-screen">
                <div class="unit-header">
                    <div class="unit-info">
                        <div class="unit-icon-large" id="unit-icon-large">📊</div>
                        <div class="unit-details">
                            <h1 id="unit-title">Título de la Unidad</h1>
                            <p id="unit-description">Descripción de la unidad</p>
                        </div>
                    </div>
                    <button class="back-btn" id="back-btn">
                        <i class="fas fa-arrow-left"></i>
                        Volver
                    </button>
                </div>
                
                <div class="content-sections">
                    <!-- Sección de video -->
                    <div class="video-section">
                        <h2 class="section-title">
                            <i class="fas fa-video"></i>
                            Video Explicativo
                        </h2>
                        <div class="video-container" id="video-container">
                            <!-- El reproductor de YouTube se insertará aquí -->
                        </div>
                        <div class="video-controls">
                            <button class="video-btn btn-primary" id="play-btn">
                                <i class="fas fa-play"></i>
                                Reproducir
                            </button>
                            <button class="video-btn btn-secondary" id="pause-btn">
                                <i class="fas fa-pause"></i>
                                Pausar
                            </button>
                        </div>
                    </div>
                    
                    <!-- Panel lateral -->
                    <div class="sidebar">
                        <!-- Flashcards -->
                        <div class="flashcard-section">
                            <h3 class="section-title">
                                <i class="fas fa-cards-blank"></i>
                                Flashcards
                            </h3>
                            <div class="flashcard-container">
                                <div class="flashcard" id="flashcard">
                                    <div class="flashcard-face flashcard-front" id="flashcard-front">
                                        <div id="flashcard-question">Pregunta</div>
                                    </div>
                                    <div class="flashcard-face flashcard-back" id="flashcard-back">
                                        <div id="flashcard-answer">Respuesta</div>
                                    </div>
                                </div>
                            </div>
                            <div class="flashcard-controls">
                                <div class="flashcard-counter" id="flashcard-counter">1 / 10</div>
                                <button class="btn-primary action-btn" id="next-flashcard">
                                    <i class="fas fa-arrow-right"></i>
                                    Siguiente
                                </button>
                            </div>
                        </div>
                        
                        <!-- Quiz rápido -->
                        <div class="quiz-section">
                            <h3 class="section-title">
                                <i class="fas fa-question-circle"></i>
                                Práctica
                            </h3>
                            <div class="quiz-preview">
                                <div class="quiz-stats">
                                    <div class="stat-item">
                                        <span class="stat-number" id="total-questions">15</span>
                                        <span class="stat-label">Preguntas</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-number" id="best-score">0%</span>
                                        <span class="stat-label">Mejor</span>
                                    </div>
                                </div>
                                <div style="display: flex; gap: var(--spacing-sm);">
                                    <button class="action-btn btn-secondary" id="practice-btn">
                                        <i class="fas fa-book-open"></i>
                                        Práctica
                                    </button>
                                    <button class="action-btn btn-primary" id="quiz-btn">
                                        <i class="fas fa-stopwatch"></i>
                                        Examen
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Timer de estudio -->
            <div class="study-timer" id="study-timer">
                <div class="timer-display" id="timer-display">00:00:00</div>
                <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 5px;">
                    Tiempo de estudio
                </div>
            </div>
            
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <script>
        // ---------- DATOS DE LA PLATAFORMA ----------
        const platformData = {
            units: [
                {
                    id: 'tct',
                    title: 'Teoría Clásica de los Tests',
                    description: 'Fundamentos del modelo lineal clásico y sus supuestos básicos',
                    icon: '📊',
                    videoId: 'hriKlRXTF0A',
                    progress: 0,
                    bestScore: 0,
                    attempts: 0,
                    studyTime: 0
                },
                {
                    id: 'confiabilidad',
                    title: 'Confiabilidad',
                    description: 'Consistencia y estabilidad de las mediciones psicométricas',
                    icon: '🎯',
                    videoId: 'aeENe9swI8E',
                    progress: 0,
                    bestScore: 0,
                    attempts: 0,
                    studyTime: 0
                },
                {
                    id: 'validez',
                    title: 'Validez',
                    description: 'Evaluación de la evidencia de validez y constructo',
                    icon: '✅',
                    videoId: 'vrU6jJ80_UU',
                    progress: 0,
                    bestScore: 0,
                    attempts: 0,
                    studyTime: 0
                },
                {
                    id: 'factorial',
                    title: 'Análisis Factorial',
                    description: 'Descubrimiento de estructuras latentes en los datos',
                    icon: '🔍',
                    videoId: 'v_pD5lwpISI',
                    progress: 0,
                    bestScore: 0,
                    attempts: 0,
                    studyTime: 0
                },
                {
                    id: 'baremacion',
                    title: 'Baremación',
                    description: 'Estandarización y normalización de puntuaciones',
                    icon: '📈',
                    videoId: 'hl8LNar2oys',
                    progress: 0,
                    bestScore: 0,
                    attempts: 0,
                    studyTime: 0
                },
                {
                    id: 'tri',
                    title: 'Teoría de Respuesta a los Ítems',
                    description: 'Modelos modernos de medición y sus aplicaciones',
                    icon: '🧮',
                    videoId: 'BRCeQo9SmSE',
                    progress: 0,
                    bestScore: 0,
                    attempts: 0,
                    studyTime: 0
                }
            ]
        };

        // ---------- BANCOS DE PREGUNTAS MEJORADOS ----------
        const questionBanks = {
            tct: [
                {
                    type: 'multiple-choice',
                    question: '¿Cuál es la ecuación fundamental de la Teoría Clásica de los Tests?',
                    options: ['X = T × E', 'X = T + E', 'E = X + T', 'T = X - E'],
                    answer: 'X = T + E',
                    explanation: 'El modelo lineal clásico establece que la puntuación observada (X) es la suma de la puntuación verdadera (T) y el error de medición (E).',
                    source: 'Apuntes-TCT.pdf',
                    difficulty: 'easy',
                    icon: '📏',
                    category: 'fundamentos'
                },
                {
                    type: 'multiple-choice',
                    question: '¿Qué representa la puntuación verdadera (T) en la TCT?',
                    options: ['La puntuación empírica obtenida', 'El promedio hipotético de puntuaciones bajo condiciones idénticas', 'El error sistemático de medición', 'La varianza residual del test'],
                    answer: 'El promedio hipotético de puntuaciones bajo condiciones idénticas',
                    explanation: 'La puntuación verdadera se define como el valor esperado de las puntuaciones observadas si se aplicaran infinitas formas paralelas del test.',
                    source: 'Apuntes-TCT.pdf',
                    difficulty: 'easy',
                    icon: '🎯',
                    category: 'conceptos'
                },
                {
                    type: 'multiple-choice',
                    question: '¿Qué se asume sobre la media del error de medición en la TCT?',
                    options: ['Es positiva', 'Es negativa', 'Es igual a cero', 'Depende del test'],
                    answer: 'Es igual a cero',
                    explanation: 'El modelo supone que los errores de medición son aleatorios y se anulan entre sí en promedio.',
                    source: 'Apuntes-TCT.pdf',
                    difficulty: 'easy',
                    icon: '⚖️',
                    category: 'supuestos'
                },
                {
                    type: 'multiple-choice',
                    question: '¿Qué mide el coeficiente de confiabilidad (ρ_XX’)?',
                    options: ['La precisión de cada ítem', 'La proporción de varianza verdadera en la puntuación total', 'La diferencia entre tests paralelos', 'La magnitud del error de estimación'],
                    answer: 'La proporción de varianza verdadera en la puntuación total',
                    explanation: 'La confiabilidad representa la proporción de la varianza total atribuible a diferencias reales en el rasgo medido.',
                    source: 'Apuntes-TCT.pdf',
                    difficulty: 'medium',
                    icon: '📊',
                    category: 'confiabilidad'
                },
                {
                    type: 'multiple-choice',
                    question: 'Si un test tiene una confiabilidad de 0.90, ¿qué implica?',
                    options: ['El 90% de la varianza se debe al error', 'El 90% de la varianza refleja diferencias verdaderas', 'El 90% de los ítems son válidos', 'El 90% del error se explica por T'],
                    answer: 'El 90% de la varianza refleja diferencias verdaderas',
                    explanation: 'Una confiabilidad de 0.90 indica que la mayor parte de la variabilidad de las puntuaciones es atribuible a la puntuación verdadera, no al error.',
                    source: 'Apuntes-TCT.pdf',
                    difficulty: 'medium',
                    icon: '📈',
                    category: 'interpretacion'
                }
            ],
            confiabilidad: [
                {
                    type: 'multiple-choice',
                    question: '¿Cómo se define el coeficiente de confiabilidad en términos de varianza?',
                    options: ['La proporción de varianza verdadera sobre la varianza empírica', 'La proporción de varianza de error sobre la varianza empírica', 'La suma de la varianza verdadera y la de error', 'La correlación entre el test y un criterio externo'],
                    answer: 'La proporción de varianza verdadera sobre la varianza empírica',
                    explanation: 'El coeficiente de confiabilidad (ρxx\') representa qué parte de la variabilidad total en las puntuaciones observadas se debe a diferencias reales en el rasgo medido.',
                    source: 'Teoría Clásica de los Tests.pdf',
                    difficulty: 'hard',
                    icon: '🎯',
                    category: 'varianza'
                },
                {
                    type: 'multiple-choice',
                    question: 'Si un test tiene una confiabilidad de 0.90, ¿qué porcentaje de la varianza de las puntuaciones se debe al error de medición?',
                    options: ['10%', '90%', '0%', '100%'],
                    answer: '10%',
                    explanation: 'La varianza de error es el complemento de la confiabilidad (1 - 0.90 = 0.10). Por lo tanto, el 10% de la varianza total es atribuible al error de medición.',
                    source: 'Teoría Clásica de los Tests.pdf',
                    difficulty: 'medium',
                    icon: '🎯',
                    category: 'interpretacion'
                }
            ],
            validez: [
                {
                    type: 'multiple-choice',
                    question: 'Según la concepción moderna y unitaria de la validez, ¿qué es lo que se valida?',
                    options: ['Las inferencias hechas a partir de las puntuaciones del test', 'El test en sí mismo, como un objeto', 'Únicamente el contenido de los ítems', 'La confiabilidad del instrumento'],
                    answer: 'Las inferencias hechas a partir de las puntuaciones del test',
                    explanation: 'La validez no es una propiedad intrínseca del test, sino el grado en que la evidencia y la teoría apoyan las interpretaciones y usos de las puntuaciones del test.',
                    source: 'Validez.pdf',
                    difficulty: 'hard',
                    icon: '✅',
                    category: 'concepto'
                }
            ],
            factorial: [
                {
                    type: 'multiple-choice',
                    question: '¿Cuál es el objetivo principal del Análisis Factorial Exploratorio (AFE)?',
                    options: ['Descubrir una estructura subyacente en un conjunto de variables', 'Confirmar una estructura teórica predefinida', 'Reducir datos a un único componente', 'Calcular la confiabilidad de un test'],
                    answer: 'Descubrir una estructura subyacente en un conjunto de variables',
                    explanation: 'El AFE es una técnica "basada en los datos" que se utiliza en las primeras etapas de la investigación para generar hipótesis sobre cuántos factores explican las correlaciones entre las variables observadas.',
                    source: 'Guía Comprensiva del Análisis Factorial.pdf',
                    difficulty: 'medium',
                    icon: '🔍',
                    category: 'exploratorio'
                }
            ],
            baremacion: [
                {
                    type: 'multiple-choice',
                    question: '¿Cuál es el principal objetivo de transformar las puntuaciones directas de un test?',
                    options: ['Facilitar su interpretación ubicando a la persona en relación a un grupo normativo', 'Aumentar la confiabilidad del test', 'Asegurar la validez de contenido', 'Hacer que las puntuaciones sean más altas'],
                    answer: 'Facilitar su interpretación ubicando a la persona en relación a un grupo normativo',
                    explanation: 'Una puntuación bruta (ej. 25 puntos) no significa nada por sí sola. Al transformarla (ej. percentil 80), podemos entender la posición relativa del individuo en comparación con el grupo de referencia.',
                    source: 'Transformación de Puntuaciones.pdf',
                    difficulty: 'easy',
                    icon: '📈',
                    category: 'interpretacion'
                }
            ],
            tri: [
                {
                    type: 'multiple-choice',
                    question: 'Una limitación clave de la TCT que la TRI resuelve es que las propiedades de los ítems...',
                    options: ['son invariantes respecto a la muestra utilizada para estimarlas', 'dependen fuertemente de la muestra utilizada para estimarlas', 'solo se aplican a tests de inteligencia', 'son siempre las mismas que las del test completo'],
                    answer: 'son invariantes respecto a la muestra utilizada para estimarlas',
                    explanation: 'En TRI, la dificultad (b) o discriminación (a) de un ítem son propiedades del ítem en sí, independientes de la muestra. En TCT, la dificultad depende de la muestra en que se calcula.',
                    source: 'Las Teorías de los Tests - Muñiz - 2010.pdf',
                    difficulty: 'hard',
                    icon: '🧮',
                    category: 'invarianza'
                }
            ]
        };

        // ---------- FLASHCARDS MEJORADAS ----------
        const flashcardData = {
            tct: [
                {
                    front: '¿Cuál es la ecuación central de la Teoría Clásica de los Tests?',
                    back: 'El modelo lineal clásico se expresa como X = T + E, donde X es la puntuación observada, T la puntuación verdadera y E el error de medición.',
                    source: 'Apuntes-TCT.pdf',
                    difficulty: 'easy',
                    icon: '📏',
                    category: 'fundamentos'
                },
                {
                    front: '¿Qué representa la puntuación verdadera (T)?',
                    back: 'Es el valor esperado de las puntuaciones observadas que una persona obtendría si realizara infinitas versiones paralelas del mismo test.',
                    source: 'Apuntes-TCT.pdf',
                    difficulty: 'easy',
                    icon: '🎯',
                    category: 'conceptos'
                },
                {
                    front: '¿Qué significa que el error de medición tenga media cero?',
                    back: 'Significa que los errores son aleatorios y, en promedio, se anulan entre sí en una población, garantizando que no sesgan las puntuaciones.',
                    source: 'Apuntes-TCT.pdf',
                    difficulty: 'easy',
                    icon: '⚖️',
                    category: 'supuestos'
                }
            ],
            confiabilidad: [
                {
                    front: '¿Qué expresa el coeficiente de confiabilidad (ρ_XX’)?',
                    back: 'Mide la proporción de la varianza total de las puntuaciones que se debe a diferencias reales en el rasgo medido, y no al error aleatorio.',
                    source: 'Apuntes-TCT.pdf',
                    difficulty: 'medium',
                    icon: '📊',
                    category: 'varianza'
                },
                {
                    front: '¿Cómo se calcula el Error Estándar de Medición (EEM)?',
                    back: 'EEM = DE × √(1 - rxx), donde DE es la desviación estándar del test y rxx es el coeficiente de confiabilidad.',
                    source: 'Teoría Clásica de los Tests.pdf',
                    difficulty: 'medium',
                    icon: '🎯',
                    category: 'calculo'
                }
            ],
            validez: [
                {
                    front: '¿Qué es la validez de contenido?',
                    back: 'Evalúa si los ítems del test representan adecuadamente el dominio o constructo que se pretende medir, asegurando la relevancia y representatividad.',
                    source: 'Validez.pdf',
                    difficulty: 'medium',
                    icon: '✅',
                    category: 'contenido'
                }
            ],
            factorial: [
                {
                    front: '¿Cuál es la diferencia entre AFE y AFC?',
                    back: 'El Análisis Factorial Exploratorio (AFE) descubre estructuras sin hipótesis previas, mientras que el Confirmatorio (AFC) prueba estructuras teóricas predefinidas.',
                    source: 'Guía Comprensiva del Análisis Factorial.pdf',
                    difficulty: 'medium',
                    icon: '🔍',
                    category: 'tipos'
                }
            ],
            baremacion: [
                {
                    front: '¿Qué es la estandarización de puntuaciones?',
                    back: 'Proceso de transformar puntuaciones brutas en puntuaciones derivadas con media y desviación estándar conocidas, facilitando la interpretación.',
                    source: 'Transformación de Puntuaciones.pdf',
                    difficulty: 'easy',
                    icon: '📈',
                    category: 'proceso'
                }
            ],
            tri: [
                {
                    front: '¿Qué es la Curva Característica del Ítem (CCI)?',
                    back: 'Función matemática que relaciona el nivel de habilidad (θ) con la probabilidad de responder correctamente un ítem, representando su funcionamiento.',
                    source: 'Las Teorías de los Tests - Muñiz - 2010.pdf',
                    difficulty: 'hard',
                    icon: '🧮',
                    category: 'funcion'
                }
            ]
        };

        // ---------- SISTEMA DE ESTADO DE LA PLATAFORMA ----------
        class PlatformState {
            constructor() {
                this.currentUnit = null;
                this.currentScreen = 'welcome';
                this.currentFlashcardIndex = 0;
                this.currentQuiz = null;
                this.quizState = {
                    questions: [],
                    currentQuestion: 0,
                    score: 0,
                    answers: [],
                    startTime: null,
                    timeLimit: 30
                };
                this.progress = this.loadProgress();
                this.player = null;
                this.currentFlashcards = [];
                this.studyStartTime = Date.now();
                this.totalStudyTime = this.loadStudyTime();
                this.achievements = this.loadAchievements();
            }
            
            loadProgress() {
                const saved = localStorage.getItem('psicometria-progress');
                return saved ? JSON.parse(saved) : {};
            }
            
            saveProgress() {
                localStorage.setItem('psicometria-progress', JSON.stringify(this.progress));
            }
            
            loadStudyTime() {
                const saved = localStorage.getItem('psicometria-study-time');
                return saved ? JSON.parse(saved) : {};
            }
            
            saveStudyTime() {
                localStorage.setItem('psicometria-study-time', JSON.stringify(this.totalStudyTime));
            }
            
            loadAchievements() {
                const saved = localStorage.getItem('psicometria-achievements');
                return saved ? JSON.parse(saved) : [];
            }
            
            saveAchievements() {
                localStorage.setItem('psicometria-achievements', JSON.stringify(this.achievements));
            }
            
            updateUnitProgress(unitId, score, attempts) {
                if (!this.progress[unitId]) {
                    this.progress[unitId] = {
                        bestScore: 0,
                        attempts: 0,
                        completed: false,
                        lastAttempt: null,
                        studyTime: 0
                    };
                }
                
                this.progress[unitId].attempts += attempts;
                this.progress[unitId].lastAttempt = Date.now();
                
                if (score > this.progress[unitId].bestScore) {
                    this.progress[unitId].bestScore = score;
                }
                
                if (score >= 80) {
                    this.progress[unitId].completed = true;
                    this.unlockAchievement('Completado', `Has completado ${platformData.units.find(u => u.id === unitId).title}`);
                }
                
                this.saveProgress();
            }
            
            updateStudyTime(unitId, timeSpent) {
                if (!this.totalStudyTime[unitId]) {
                    this.totalStudyTime[unitId] = 0;
                }
                this.totalStudyTime[unitId] += timeSpent;
                
                // Actualizar progreso general
                const totalTime = Object.values(this.totalStudyTime).reduce((sum, time) => sum + time, 0);
                if (totalTime >= 3600000) { // 1 hora
                    this.unlockAchievement('Estudiante Dedicado', 'Has estudiado más de 1 hora en total');
                }
                
                this.saveStudyTime();
            }
            
            unlockAchievement(title, description) {
                const achievement = {
                    id: Date.now(),
                    title,
                    description,
                    timestamp: Date.now()
                };
                
                this.achievements.push(achievement);
                this.saveAchievements();
                this.showAchievement(achievement);
            }
            
            showAchievement(achievement) {
                // Crear y mostrar notificación de logro
                const achievementEl = document.createElement('div');
                achievementEl.className = 'achievement-badge show';
                achievementEl.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-trophy" style="color: var(--warning-color); font-size: 1.5rem;"></i>
                        <div>
                            <div style="font-weight: 600; color: var(--accent-color);">${achievement.title}</div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">${achievement.description}</div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(achievementEl);
                
                setTimeout(() => {
                    achievementEl.classList.remove('show');
                    setTimeout(() => {
                        document.body.removeChild(achievementEl);
                    }, 300);
                }, 3000);
            }
        }

        // ---------- RENDERIZADOR DE LA PLATAFORMA ----------
        class PlatformRenderer {
            constructor(container, state) {
                this.container = container;
                this.state = state;
                this.studyTimer = null;
            }
            
            renderWelcomeScreen() {
                const unitsGrid = document.getElementById('units-grid');
                unitsGrid.innerHTML = '';
                
                // Efecto de escritura para el título
                const typed = new Typed('#hero-title', {
                    strings: ['Plataforma de Estudio', 'Psicometría Aplicada II'],
                    typeSpeed: 50,
                    backSpeed: 30,
                    backDelay: 2000,
                    loop: true,
                    showCursor: true,
                    cursorChar: '|'
                });
                
                platformData.units.forEach((unit, index) => {
                    const progress = this.state.progress[unit.id] || {
                        bestScore: 0,
                        attempts: 0,
                        completed: false
                    };
                    
                    const unitCard = document.createElement('div');
                    unitCard.className = 'unit-card reveal';
                    
                    unitCard.innerHTML = `
                        <div class="unit-icon">${unit.icon}</div>
                        <h3 class="unit-title">${unit.title}</h3>
                        <p class="unit-description">${unit.description}</p>
                        
                        <div class="unit-progress">
                            <div class="progress-bar-container">
                                <div class="progress-bar" style="width: ${progress.bestScore}%"></div>
                            </div>
                            <div class="progress-text">${progress.bestScore}%</div>
                        </div>
                        
                        <div class="difficulty-indicator">
                            <div class="difficulty-dot ${this.getDifficultyLevel(unit.id) === 'easy' ? 'active' : ''}"></div>
                            <div class="difficulty-dot ${this.getDifficultyLevel(unit.id) === 'medium' ? 'medium' : ''}"></div>
                            <div class="difficulty-dot ${this.getDifficultyLevel(unit.id) === 'hard' ? 'hard' : ''}"></div>
                        </div>
                        
                        <div class="unit-actions">
                            <button class="action-btn btn-primary" data-action="study" data-unit="${unit.id}">
                                <i class="fas fa-play"></i>
                                Estudiar
                            </button>
                            <button class="action-btn btn-secondary" data-action="practice" data-unit="${unit.id}">
                                <i class="fas fa-question-circle"></i>
                                Practicar
                            </button>
                        </div>
                    `;
                    
                    // Agregar event listeners
                    unitCard.querySelector('[data-action="study"]').addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.startUnitStudy(unit.id);
                    });
                    
                    unitCard.querySelector('[data-action="practice"]').addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.startUnitPractice(unit.id);
                    });
                    
                    unitCard.addEventListener('click', () => {
                        this.openUnit(unit.id);
                    });
                    
                    unitsGrid.appendChild(unitCard);
                    
                    // Animar con retraso
                    setTimeout(() => {
                        unitCard.classList.add('active');
                    }, index * 200);
                });
                
                // Iniciar timer de estudio
                this.startStudyTimer();
            }
            
            getDifficultyLevel(unitId) {
                const questions = questionBanks[unitId] || [];
                if (questions.length === 0) return 'easy';
                
                const difficulties = questions.map(q => q.difficulty);
                const hardCount = difficulties.filter(d => d === 'hard').length;
                const mediumCount = difficulties.filter(d => d === 'medium').length;
                
                if (hardCount > 0) return 'hard';
                if (mediumCount > 0) return 'medium';
                return 'easy';
            }
            
            startStudyTimer() {
                let startTime = Date.now();
                
                this.studyTimer = setInterval(() => {
                    const elapsed = Date.now() - startTime;
                    const totalSeconds = Math.floor(elapsed / 1000);
                    const hours = Math.floor(totalSeconds / 3600);
                    const minutes = Math.floor((totalSeconds % 3600) / 60);
                    const seconds = totalSeconds % 60;
                    
                    document.getElementById('timer-display').textContent = 
                        `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }, 1000);
            }
            
            renderUnitScreen(unitId) {
                const unit = platformData.units.find(u => u.id === unitId);
                if (!unit) return;
                
                this.state.currentUnit = unit;
                
                // Actualizar información de la unidad
                document.getElementById('unit-icon-large').textContent = unit.icon;
                document.getElementById('unit-title').textContent = unit.title;
                document.getElementById('unit-description').textContent = unit.description;
                
                // Cargar video de YouTube
                this.loadYouTubeVideo(unit.videoId);
                
                // Cargar flashcards
                this.loadFlashcards(unitId);
                
                // Actualizar estadísticas
                const progress = this.state.progress[unitId] || { bestScore: 0, attempts: 0 };
                document.getElementById('best-score').textContent = `${progress.bestScore}%`;
            }
            
            loadYouTubeVideo(videoId) {
                const container = document.getElementById('video-container');
                container.innerHTML = `
                    <iframe 
                        id="youtube-player"
                        src="https://www.youtube.com/embed/${videoId}?enablejsapi=1&origin=${window.location.origin}"
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                        allowfullscreen>
                    </iframe>
                `;
                
                // Inicializar controles del video
                document.getElementById('play-btn').addEventListener('click', () => {
                    if (this.state.player) {
                        this.state.player.playVideo();
                    }
                });
                
                document.getElementById('pause-btn').addEventListener('click', () => {
                    if (this.state.player) {
                        this.state.player.pauseVideo();
                    }
                });
            }
            
            loadFlashcards(unitId) {
                const flashcards = flashcardData[unitId] || [];
                this.state.currentFlashcards = flashcards;
                
                if (flashcards.length > 0) {
                    this.renderFlashcard(flashcards[0], 0, flashcards.length);
                    this.setupFlashcardNavigation(flashcards);
                } else {
                    document.getElementById('flashcard-question').textContent = 'Flashcards no disponibles para esta unidad';
                    document.getElementById('flashcard-counter').textContent = '0 / 0';
                }
            }
            
            renderFlashcard(flashcard, index, total) {
                document.getElementById('flashcard-question').textContent = flashcard.front;
                document.getElementById('flashcard-answer').textContent = flashcard.back;
                document.getElementById('flashcard-counter').textContent = `${index + 1} / ${total}`;
                
                // Resetear el estado de la flashcard
                const flashcardElement = document.getElementById('flashcard');
                flashcardElement.classList.remove('flipped');
                
                // Evento de clic para voltear
                flashcardElement.onclick = () => {
                    flashcardElement.classList.toggle('flipped');
                };
                
                // Animar entrada
                anime({
                    targets: flashcardElement,
                    opacity: [0, 1],
                    scale: [0.8, 1],
                    duration: 400,
                    easing: 'easeOutBack'
                });
            }
            
            setupFlashcardNavigation(flashcards) {
                let currentIndex = 0;
                
                document.getElementById('next-flashcard').addEventListener('click', () => {
                    currentIndex = (currentIndex + 1) % flashcards.length;
                    this.renderFlashcard(flashcards[currentIndex], currentIndex, flashcards.length);
                });
            }
            
            startUnitStudy(unitId) {
                this.openUnit(unitId);
            }
            
            startUnitPractice(unitId) {
                this.loadQuiz(unitId, 'practice');
            }
            
            openUnit(unitId) {
                document.getElementById('welcome-screen').style.display = 'none';
                document.getElementById('unit-screen').style.display = 'block';
                this.renderUnitScreen(unitId);
                this.state.currentScreen = 'unit';
                
                // Actualizar barra de progreso
                this.updateProgressBar(50);
            }
            
            loadQuiz(unitId, mode) {
                const questions = questionBanks[unitId] || [];
                
                if (questions.length === 0) {
                    alert('No hay preguntas disponibles para esta unidad');
                    return;
                }
                
                // Seleccionar 15 preguntas aleatorias o todas si hay menos
                const selectedQuestions = this.selectRandomQuestions(questions, Math.min(15, questions.length));
                
                // Configurar el estado del quiz
                this.state.quizState = {
                    questions: selectedQuestions,
                    currentQuestion: 0,
                    score: 0,
                    answers: [],
                    startTime: Date.now(),
                    timeLimit: mode === 'exam' ? 30 : null
                };
                
                this.renderQuizScreen(mode);
            }
            
            selectRandomQuestions(questions, count) {
                const shuffled = [...questions].sort(() => Math.random() - 0.5);
                return shuffled.slice(0, count);
            }
            
            renderQuizScreen(mode) {
                document.getElementById('unit-screen').style.display = 'none';
                
                // Crear pantalla de quiz
                const quizScreen = document.createElement('div');
                quizScreen.id = 'quiz-screen';
                quizScreen.className = 'quiz-screen';
                quizScreen.innerHTML = `
                    <div class="quiz-header">
                        <div class="quiz-info">
                            <h2 id="quiz-title">${mode === 'exam' ? 'Examen de Unidad' : 'Práctica de Unidad'}</h2>
                            <div class="quiz-progress-text" id="quiz-progress-text">Pregunta 1 de ${this.state.quizState.questions.length}</div>
                        </div>
                        ${mode === 'exam' ? `
                            <div class="quiz-timer" id="quiz-timer">
                                <i class="fas fa-hourglass-half"></i>
                                <span id="timer-display">30</span>s
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="quiz-progress">
                        <div class="quiz-progress-bar" id="quiz-progress-bar"></div>
                    </div>
                    
                    <div id="quiz-content"></div>
                `;
                
                document.querySelector('.content-wrapper').appendChild(quizScreen);
                
                if (mode === 'practice') {
                    quizScreen.querySelector('#quiz-timer').style.display = 'none';
                }
                
                this.renderQuestion();
                
                // Iniciar timer si es modo examen
                if (mode === 'exam') {
                    this.startQuizTimer();
                }
            }
            
            startQuizTimer() {
                let timeLeft = this.state.quizState.timeLimit;
                const timerDisplay = document.getElementById('timer-display');
                
                const timer = setInterval(() => {
                    timerDisplay.textContent = timeLeft;
                    timeLeft--;
                    
                    if (timeLeft < 0) {
                        clearInterval(timer);
                        this.handleTimeOut();
                    }
                }, 1000);
            }
            
            handleTimeOut() {
                this.selectAnswer('Tiempo agotado');
            }
            
            renderQuestion() {
                const quizState = this.state.quizState;
                const question = quizState.questions[quizState.currentQuestion];
                
                document.getElementById('quiz-progress-text').textContent = 
                    `Pregunta ${quizState.currentQuestion + 1} de ${quizState.questions.length}`;
                
                // Actualizar barra de progreso
                const progress = ((quizState.currentQuestion + 1) / quizState.questions.length) * 100;
                document.getElementById('quiz-progress-bar').style.width = `${progress}%`;
                
                // Renderizar la pregunta
                const contentContainer = document.getElementById('quiz-content');
                contentContainer.innerHTML = `
                    <div class="question-container">
                        <div class="question-text">
                            <span style="font-size: 2rem; margin-right: 15px;">${question.icon || '❓'}</span>
                            ${question.question}
                        </div>
                        <div class="difficulty-indicator">
                            <div class="difficulty-dot ${question.difficulty === 'easy' ? 'active' : ''}"></div>
                            <div class="difficulty-dot ${question.difficulty === 'medium' ? 'medium' : ''}"></div>
                            <div class="difficulty-dot ${question.difficulty === 'hard' ? 'hard' : ''}"></div>
                        </div>
                        <div class="answer-options">
                            ${question.options.map((option, index) => `
                                <button class="answer-btn" data-answer="${option}">
                                    <div class="answer-option-letter">${String.fromCharCode(65 + index)}</div>
                                    <span>${option}</span>
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
                
                // Agregar event listeners a las opciones
                contentContainer.querySelectorAll('.answer-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.selectAnswer(btn.dataset.answer);
                    });
                });
                
                // Animar entrada
                anime({
                    targets: '.question-container',
                    opacity: [0, 1],
                    translateY: [30, 0],
                    duration: 600,
                    easing: 'easeOutQuart'
                });
            }
            
            selectAnswer(answer) {
                const quizState = this.state.quizState;
                const question = quizState.questions[quizState.currentQuestion];
                const isCorrect = answer === question.answer;
                
                quizState.answers.push({
                    question: question.question,
                    userAnswer: answer,
                    correctAnswer: question.answer,
                    isCorrect: isCorrect,
                    explanation: question.explanation,
                    difficulty: question.difficulty
                });
                
                if (isCorrect) {
                    quizState.score++;
                }
                
                // Mostrar retroalimentación
                this.showAnswerFeedback(isCorrect, question);
                
                // Pasar a la siguiente pregunta después de un breve retraso
                setTimeout(() => {
                    this.nextQuestion();
                }, 2000);
            }
            
            showAnswerFeedback(isCorrect, question) {
                // Marcar la respuesta correcta
                document.querySelectorAll('.answer-btn').forEach(btn => {
                    if (btn.dataset.answer === question.answer) {
                        btn.classList.add('correct');
                    } else if (btn.dataset.answer !== question.answer && !isCorrect) {
                        btn.classList.add('wrong');
                    }
                });
                
                // Mostrar explicación
                const feedback = document.createElement('div');
                feedback.className = 'feedback-container show';
                feedback.innerHTML = `
                    <div class="feedback-header">
                        <i class="fas fa-${isCorrect ? 'check-circle' : 'times-circle'}" style="color: var(--${isCorrect ? 'success' : 'danger'}-color);"></i>
                        <strong>${isCorrect ? '¡Correcto!' : 'Incorrecto'}</strong>
                    </div>
                    <div class="feedback-content">${question.explanation}</div>
                    ${question.source ? `<div class="feedback-source">Fuente: ${question.source}</div>` : ''}
                `;
                
                document.getElementById('quiz-content').appendChild(feedback);
                
                // Deshabilitar todos los botones
                document.querySelectorAll('.answer-btn').forEach(btn => {
                    btn.disabled = true;
                });
            }
            
            nextQuestion() {
                const quizState = this.state.quizState;
                
                if (quizState.currentQuestion < quizState.questions.length - 1) {
                    quizState.currentQuestion++;
                    this.renderQuestion();
                } else {
                    this.finishQuiz();
                }
            }
            
            finishQuiz() {
                const quizState = this.state.quizState;
                const score = quizState.score;
                const total = quizState.questions.length;
                const percentage = Math.round((score / total) * 100);
                
                // Actualizar progreso
                this.state.updateUnitProgress(this.state.currentUnit.id, percentage, 1);
                
                // Mostrar pantalla de resultados
                this.showResults(score, total, percentage);
            }
            
            showResults(score, total, percentage) {
                // Remover pantalla de quiz
                const quizScreen = document.getElementById('quiz-screen');
                if (quizScreen) {
                    quizScreen.remove();
                }
                
                // Crear pantalla de resultados
                const resultsScreen = document.createElement('div');
                resultsScreen.id = 'results-screen';
                resultsScreen.className = 'results-screen';
                resultsScreen.innerHTML = `
                    <h2 class="results-title">¡Evaluación completada!</h2>
                    
                    <div class="score-display">
                        <i class="fas fa-trophy score-icon"></i>
                        <span>Tu puntaje: ${score} de ${total} (${percentage}%)</span>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <span class="stat-value" id="accuracy-stat">${percentage}%</span>
                            <span class="stat-label">Precisión</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-value" id="time-stat">${this.formatTime(Math.round((Date.now() - this.state.quizState.startTime) / 1000))}</span>
                            <span class="stat-label">Tiempo Total</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-value" id="streak-stat">${this.calculateMaxStreak()}</span>
                            <span class="stat-label">Racha Máxima</span>
                        </div>
                    </div>
                    
                    <div class="results-buttons">
                        <button class="results-btn btn-primary" id="review-errors-btn">
                            <i class="fas fa-search"></i>
                            Revisar Errores
                        </button>
                        <button class="results-btn btn-accent" id="download-pdf-btn">
                            <i class="fas fa-file-pdf"></i>
                            Descargar PDF
                        </button>
                        <button class="results-btn btn-secondary" id="restart-btn">
                            <i class="fas fa-redo"></i>
                            Volver a empezar
                        </button>
                    </div>
                `;
                
                document.querySelector('.content-wrapper').appendChild(resultsScreen);
                
                // Mostrar recomendaciones si hay errores
                const wrongAnswers = this.state.quizState.answers.filter(a => !a.isCorrect);
                if (wrongAnswers.length > 0) {
                    this.showRecommendations(wrongAnswers);
                }
                
                // Configurar botones de resultados
                this.setupResultsButtons();
                
                // Animar estadísticas
                anime({
                    targets: '.stat-value',
                    innerHTML: [0, (el) => el.textContent],
                    duration: 2000,
                    easing: 'easeOutQuart',
                    round: 1
                });
            }
            
            calculateMaxStreak() {
                let maxStreak = 0;
                let currentStreak = 0;
                
                this.state.quizState.answers.forEach(answer => {
                    if (answer.isCorrect) {
                        currentStreak++;
                        maxStreak = Math.max(maxStreak, currentStreak);
                    } else {
                        currentStreak = 0;
                    }
                });
                
                return maxStreak;
            }
            
            showRecommendations(wrongAnswers) {
                const resultsScreen = document.getElementById('results-screen');
                const recommendationsSection = document.createElement('div');
                recommendationsSection.className = 'recommendations-section';
                recommendationsSection.innerHTML = `
                    <h3 class="recommendations-title">
                        <i class="fas fa-lightbulb"></i>
                        Áreas para reforzar
                    </h3>
                    <ul class="recommendations-list" id="recommendations-list"></ul>
                `;
                
                resultsScreen.appendChild(recommendationsSection);
                
                const recommendationsList = document.getElementById('recommendations-list');
                
                // Agrupar errores por categoría
                const errorsByCategory = {};
                wrongAnswers.forEach(answer => {
                    const category = answer.category || 'general';
                    if (!errorsByCategory[category]) {
                        errorsByCategory[category] = [];
                    }
                    errorsByCategory[category].push(answer);
                });
                
                Object.keys(errorsByCategory).forEach(category => {
                    const li = document.createElement('li');
                    li.className = 'recommendation-item';
                    li.innerHTML = `
                        <strong>Reforzar ${category}:</strong> 
                        Tienes ${errorsByCategory[category].length} error(es) en esta área.
                        <div style="margin-top: 8px; font-size: 0.9rem; color: var(--text-secondary);">
                            ${errorsByCategory[category][0].explanation.substring(0, 100)}...
                        </div>
                    `;
                    recommendationsList.appendChild(li);
                });
            }
            
            setupResultsButtons() {
                // Botón de revisar errores
                document.getElementById('review-errors-btn').addEventListener('click', () => {
                    this.showErrorReview();
                });
                
                // Botón de descargar PDF
                document.getElementById('download-pdf-btn').addEventListener('click', () => {
                    this.downloadResultsPDF();
                });
                
                // Botón de volver a empezar
                document.getElementById('restart-btn').addEventListener('click', () => {
                    this.goBack();
                });
            }
            
            showErrorReview() {
                const wrongAnswers = this.state.quizState.answers.filter(a => !a.isCorrect);
                let reviewHTML = '<h3>Revisión de Errores</h3>';
                
                wrongAnswers.forEach((error, index) => {
                    reviewHTML += `
                        <div class="error-card" style="background: var(--bg-card); padding: 20px; margin: 10px 0; border-radius: 8px; border-left: 4px solid var(--danger-color);">
                            <div class="error-question"><strong>Pregunta ${index + 1}:</strong> ${error.question}</div>
                            <div class="error-comparison" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 10px 0;">
                                <div class="user-answer" style="background: var(--bg-secondary); padding: 10px; border-radius: 4px;"><strong>Tu respuesta:</strong><br>${error.userAnswer}</div>
                                <div class="correct-answer" style="background: var(--bg-secondary); padding: 10px; border-radius: 4px;"><strong>Respuesta correcta:</strong><br>${error.correctAnswer}</div>
                            </div>
                            <div class="error-explanation"><strong>Explicación:</strong><br>${error.explanation}</div>
                        </div>
                    `;
                });
                
                // Crear modal
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                    background: rgba(0,0,0,0.8); z-index: 2000;
                    display: flex; align-items: center; justify-content: center;
                    padding: 20px;
                `;
                modal.innerHTML = `
                    <div style="background: var(--bg-card); padding: 30px; border-radius: 16px; max-width: 800px; max-height: 80vh; overflow-y: auto;">
                        ${reviewHTML}
                        <button onclick="this.parentElement.parentElement.remove()" style="margin-top: 20px; padding: 10px 20px; background: var(--accent-color); color: white; border: none; border-radius: 8px; cursor: pointer;">
                            Cerrar
                        </button>
                    </div>
                `;
                
                document.body.appendChild(modal);
            }
            
            downloadResultsPDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');
                const unit = this.state.currentUnit;
                const quizState = this.state.quizState;
                const score = quizState.score;
                const total = quizState.questions.length;
                const percentage = Math.round((score / total) * 100);
                const date = new Date().toLocaleDateString('es-ES');
                
                // Colores
                const primaryColor = [44, 62, 80];
                const accentColor = [231, 76, 60];
                
                // Título
                doc.setFontSize(20);
                doc.setFillColor(...primaryColor);
                doc.rect(0, 0, 210, 40, 'F');
                doc.setTextColor(255, 255, 255);
                doc.text(`Resultados - ${unit.title}`, 20, 25);
                
                // Información básica
                doc.setTextColor(...primaryColor);
                doc.setFontSize(12);
                doc.text(`Fecha: ${date}`, 20, 50);
                doc.text(`Puntaje: ${score} de ${total} (${percentage}%)`, 20, 60);
                doc.text(`Tiempo total: ${this.formatTime(Math.round((Date.now() - quizState.startTime) / 1000))}`, 20, 70);
                
                // Gráfico de barras simple
                doc.setFillColor(...accentColor);
                doc.rect(20, 80, percentage * 1.5, 10, 'F');
                doc.setFillColor(240, 240, 240);
                doc.rect(20 + percentage * 1.5, 80, 150 - percentage * 1.5, 10, 'F');
                doc.setTextColor(...primaryColor);
                doc.text(`Progreso: ${percentage}%`, 20, 100);
                
                // Errores
                const wrongAnswers = quizState.answers.filter(a => !a.isCorrect);
                if (wrongAnswers.length > 0) {
                    doc.text(`Errores (${wrongAnswers.length}):`, 20, 120);
                    
                    let y = 130;
                    wrongAnswers.forEach((error, i) => {
                        if (y > 280) {
                            doc.addPage();
                            y = 20;
                        }
                        
                        doc.setFontSize(10);
                        doc.text(`${i + 1}. ${error.question.substring(0, 80)}...`, 20, y);
                        doc.text(`Tu respuesta: ${error.userAnswer}`, 20, y + 6);
                        doc.text(`Correcta: ${error.correctAnswer}`, 20, y + 12);
                        y += 25;
                    });
                } else {
                    doc.text('¡No hubo errores! 🎉', 20, 120);
                }
                
                doc.save(`resultados_${unit.id}.pdf`);
            }
            
            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            }
            
            goBack() {
                // Limpiar pantallas
                const quizScreen = document.getElementById('quiz-screen');
                const resultsScreen = document.getElementById('results-screen');
                
                if (quizScreen) quizScreen.remove();
                if (resultsScreen) resultsScreen.remove();
                
                // Mostrar pantalla de inicio
                document.getElementById('welcome-screen').style.display = 'block';
                document.getElementById('unit-screen').style.display = 'none';
                this.state.currentScreen = 'welcome';
                
                // Actualizar barra de progreso
                this.updateProgressBar(0);
            }
            
            updateProgressBar(percentage) {
                const progressFill = document.getElementById('progress-fill');
                progressFill.style.width = `${percentage}%`;
            }
        }

        // ---------- CONTROLADOR PRINCIPAL ----------
        class PlatformController {
            constructor() {
                this.state = new PlatformState();
                this.renderer = new PlatformRenderer(document.body, this.state);
                this.init();
            }
            
            init() {
                this.initializeVantaBackground();
                this.bindEvents();
                this.loadInitialScreen();
                this.initializeYouTubeAPI();
                this.initializeScrollAnimations();
            }
            
            initializeVantaBackground() {
                if (typeof VANTA !== 'undefined') {
                    VANTA.NET({
                        el: "#vanta-bg",
                        mouseControls: true,
                        touchControls: true,
                        gyroControls: false,
                        minHeight: 200.00,
                        minWidth: 200.00,
                        scale: 1.00,
                        scaleMobile: 1.00,
                        color: 0x6366f1,
                        backgroundColor: 0x1a1a1a,
                        points: 8.00,
                        maxDistance: 25.00,
                        spacing: 18.00
                    });
                }
            }
            
            initializeScrollAnimations() {
                const observerOptions = {
                    threshold: 0.1,
                    rootMargin: '0px 0px -50px 0px'
                };
                
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('active');
                        }
                    });
                }, observerOptions);
                
                document.querySelectorAll('.reveal').forEach(el => {
                    observer.observe(el);
                });
            }
            
            bindEvents() {
                // Navegación principal
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.navigateToSection(link.dataset.section);
                    });
                });
                
                // Botón de retroceso
                document.getElementById('back-btn').addEventListener('click', () => {
                    this.goBack();
                });
                
                // Botones de práctica y examen
                document.getElementById('practice-btn').addEventListener('click', () => {
                    this.renderer.loadQuiz(this.state.currentUnit.id, 'practice');
                });
                
                document.getElementById('quiz-btn').addEventListener('click', () => {
                    this.renderer.loadQuiz(this.state.currentUnit.id, 'exam');
                });
            }
            
            loadInitialScreen() {
                this.renderer.renderWelcomeScreen();
            }
            
            navigateToSection(section) {
                // Actualizar navegación activa
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                document.querySelector(`[data-section="${section}"]`).classList.add('active');
                
                // Manejar navegación
                switch(section) {
                    case 'home':
                        this.showWelcomeScreen();
                        break;
                    case 'dashboard':
                        this.showDashboard();
                        break;
                    case 'exam':
                        this.showFinalExam();
                        break;
                    case 'settings':
                        this.showSettings();
                        break;
                }
            }
            
            showWelcomeScreen() {
                document.getElementById('welcome-screen').style.display = 'block';
                document.getElementById('unit-screen').style.display = 'none';
                this.state.currentScreen = 'welcome';
                this.renderer.renderWelcomeScreen();
            }
            
            showDashboard() {
                // Crear dashboard de progreso
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                    background: rgba(0,0,0,0.8); z-index: 2000;
                    display: flex; align-items: center; justify-content: center;
                    padding: 20px;
                `;
                
                const completedUnits = Object.keys(this.state.progress).filter(unitId => 
                    this.state.progress[unitId].completed
                ).length;
                
                const totalStudyTime = Object.values(this.state.totalStudyTime).reduce((sum, time) => sum + time, 0);
                const hours = Math.floor(totalStudyTime / 3600000);
                const minutes = Math.floor((totalStudyTime % 3600000) / 60000);
                
                modal.innerHTML = `
                    <div style="background: var(--bg-card); padding: 30px; border-radius: 16px; max-width: 600px; width: 100%;">
                        <h2 style="color: var(--accent-color); margin-bottom: 20px;">Dashboard de Progreso</h2>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div style="text-align: center; padding: 20px; background: var(--bg-secondary); border-radius: 8px;">
                                <div style="font-size: 2rem; font-weight: bold; color: var(--success-color);">${completedUnits}/${platformData.units.length}</div>
                                <div style="color: var(--text-secondary);">Unidades Completadas</div>
                            </div>
                            <div style="text-align: center; padding: 20px; background: var(--bg-secondary); border-radius: 8px;">
                                <div style="font-size: 2rem; font-weight: bold; color: var(--info-color);">${hours}h ${minutes}m</div>
                                <div style="color: var(--text-secondary);">Tiempo de Estudio</div>
                            </div>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <h3 style="margin-bottom: 10px;">Logros Desbloqueados:</h3>
                            <div style="max-height: 200px; overflow-y: auto;">
                                ${this.state.achievements.length > 0 ? 
                                    this.state.achievements.map(achievement => `
                                        <div style="padding: 10px; background: var(--bg-secondary); border-radius: 4px; margin-bottom: 5px; display: flex; align-items: center; gap: 10px;">
                                            <i class="fas fa-trophy" style="color: var(--warning-color);"></i>
                                            <div>
                                                <div style="font-weight: 600;">${achievement.title}</div>
                                                <div style="font-size: 0.8rem; color: var(--text-secondary);">${achievement.description}</div>
                                            </div>
                                        </div>
                                    `).join('') : 
                                    '<p style="color: var(--text-secondary);">No hay logros desbloqueados aún.</p>'
                                }
                            </div>
                        </div>
                        <button onclick="this.parentElement.parentElement.remove()" style="padding: 10px 20px; background: var(--accent-color); color: white; border: none; border-radius: 8px; cursor: pointer;">
                            Cerrar
                        </button>
                    </div>
                `;
                
                document.body.appendChild(modal);
            }
            
            showFinalExam() {
                alert('Examen final integrador - Próximamente disponible');
            }
            
            showSettings() {
                // Crear modal de configuración
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                    background: rgba(0,0,0,0.8); z-index: 2000;
                    display: flex; align-items: center; justify-content: center;
                    padding: 20px;
                `;
                
                modal.innerHTML = `
                    <div style="background: var(--bg-card); padding: 30px; border-radius: 16px; max-width: 400px; width: 100%;">
                        <h2 style="color: var(--accent-color); margin-bottom: 20px;">Configuración</h2>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 10px;">Modo Oscuro:</label>
                            <button id="theme-toggle" style="padding: 10px 20px; background: var(--info-color); color: white; border: none; border-radius: 8px; cursor: pointer;">
                                ${document.body.getAttribute('data-theme') === 'dark' ? 'Desactivar' : 'Activar'}
                            </button>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 10px;">Restablecer Progreso:</label>
                            <button id="reset-progress" style="padding: 10px 20px; background: var(--danger-color); color: white; border: none; border-radius: 8px; cursor: pointer;">
                                Restablecer
                            </button>
                        </div>
                        <button onclick="this.parentElement.parentElement.remove()" style="padding: 10px 20px; background: var(--text-muted); color: white; border: none; border-radius: 8px; cursor: pointer;">
                            Cerrar
                        </button>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Configurar botones del modal
                modal.querySelector('#theme-toggle').addEventListener('click', () => {
                    const currentTheme = document.body.getAttribute('data-theme');
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    document.body.setAttribute('data-theme', newTheme);
                    modal.querySelector('#theme-toggle').textContent = newTheme === 'dark' ? 'Desactivar' : 'Activar';
                    localStorage.setItem('theme', newTheme);
                });
                
                modal.querySelector('#reset-progress').addEventListener('click', () => {
                    if (confirm('¿Estás seguro de que quieres restablecer todo el progreso?')) {
                        localStorage.removeItem('psicometria-progress');
                        localStorage.removeItem('psicometria-study-time');
                        localStorage.removeItem('psicometria-achievements');
                        location.reload();
                    }
                });
            }
            
            goBack() {
                if (this.state.currentScreen === 'unit') {
                    this.showWelcomeScreen();
                } else if (this.state.currentScreen === 'quiz') {
                    this.renderer.closeQuiz();
                } else if (this.state.currentScreen === 'results') {
                    this.renderer.goBack();
                }
            }
            
            initializeYouTubeAPI() {
                window.onYouTubeIframeAPIReady = () => {
                    this.state.player = new YT.Player('youtube-player', {
                        events: {
                            'onReady': (event) => {
                                console.log('YouTube player ready');
                            }
                        }
                    });
                };
            }
        }

        // ---------- INICIALIZAR APLICACIÓN ----------
        document.addEventListener('DOMContentLoaded', () => {
            // Cargar tema guardado
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                document.body.setAttribute('data-theme', savedTheme);
            }
            
            new PlatformController();
        });
    </script>
</body>
</html>