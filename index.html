<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psicometría Inmersiva — Edición 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #34495e;
            --accent: #27ae60;
            --background: #ecf0f1;
            --text: #2c3e50;
            --white: #ffffff;
            --muted: #5f6b7a;
            --line: rgba(44, 62, 80, 0.2);
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background);
            color: var(--text);
        }
        
        .navbar {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            box-shadow: 0 4px 20px rgba(44, 62, 80, 0.15);
        }
        
        .nav-item {
            transition: all 0.3s ease;
            border-radius: 8px;
            padding: 0.5rem 1rem;
        }
        
        .nav-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .nav-item.active {
            background-color: var(--accent);
            color: white;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(44, 62, 80, 0.1);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(44, 62, 80, 0.15);
        }
        
        .progress-bar {
            background: linear-gradient(90deg, var(--accent), #2ecc71);
            border-radius: 10px;
            height: 12px;
            transition: width 0.8s ease;
        }
        
        .progress-bg {
            background-color: #e0e0e0;
            border-radius: 10px;
            height: 12px;
        }
        
        .flip-card {
            background-color: transparent;
            perspective: 1000px;
            height: 300px;
        }
        
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }
        
        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        
        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .flip-card-front {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }
        
        .flip-card-back {
            background: linear-gradient(135deg, var(--accent), #2ecc71);
            color: white;
            transform: rotateY(180deg);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(44, 62, 80, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--accent), #2ecc71);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.3);
        }
        
        .badge {
            background: linear-gradient(135deg, var(--accent), #2ecc71);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .stat-card {
            background: linear-gradient(135deg, white, #f8f9fa);
            border-left: 4px solid var(--accent);
        }
        
        .topic-item {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .topic-item:hover {
            background-color: #f8f9fa;
            transform: translateX(8px);
        }
        
        .topic-completed {
            background-color: rgba(39, 174, 96, 0.1);
            border-left: 4px solid var(--accent);
        }
        
        .quiz-option {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .quiz-option:hover {
            background-color: #f8f9fa;
            transform: translateX(4px);
        }
        
        .quiz-option.selected {
            background-color: rgba(39, 174, 96, 0.1);
            border-color: var(--accent);
        }
        
        .quiz-option.correct {
            background-color: rgba(39, 174, 96, 0.2);
            border-color: var(--accent);
        }
        
        .quiz-option.incorrect {
            background-color: rgba(231, 76, 60, 0.2);
            border-color: #e74c3c;
        }
        
        .timer {
            font-family: 'Courier New', monospace;
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent);
        }
        
        .youtube-player {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(44, 62, 80, 0.15);
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .achievement-badge {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin: 0 auto;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .floating-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .json-error {
            background-color: #fee;
            border: 1px solid #fcc;
            color: #c33;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        /* Estilos para reactivos de asociación */
        .association-item {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem;
            cursor: move;
            transition: all 0.3s ease;
        }

        .association-item:hover {
            border-color: var(--accent);
            transform: scale(1.02);
        }

        .association-item.dragging {
            opacity: 0.5;
        }

        .association-target {
            background: #f8f9fa;
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem;
            min-height: 60px;
            transition: all 0.3s ease;
        }

        .association-target.drag-over {
            background: #e3f2fd;
            border-color: #2196f3;
        }

        .association-target.correct {
            background: #e8f5e8;
            border-color: #4caf50;
        }

        .association-target.incorrect {
            background: #ffeaea;
            border-color: #f44336;
        }

        /* Estilos para fill-in-the-blank */
        .fill-input {
            border: 2px solid #ddd;
            border-radius: 4px;
            padding: 0.5rem;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .fill-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .fill-input.correct {
            border-color: #4caf50;
            background-color: #e8f5e8;
        }

        .fill-input.incorrect {
            border-color: #f44336;
            background-color: #ffeaea;
        }

        .boicoteador{
            border:1px dashed rgba(44, 62, 80, 0.35);
            background: rgba(255,255,255,.6);
            padding:.75rem 1rem;
            border-radius:12px;
            margin-bottom:10px;
            font-size:.98rem;
            color: #34495e;
        }

        .boicoteador{ display:inline }

        .humor-card{
            display:flex;
            align-items:flex-start;
            gap:.6rem;
            border:1px dashed var(--line);
            background: rgba(255,255,255,.04);
            padding:.75rem 1rem;
            border-radius:12px;
            margin-bottom:12px;
            font-size:.98rem;
            color: var(--muted);
            position:relative;
            opacity:0;
            transform: translateY(-4px);
            animation: humor-appear .28s ease-out forwards;
        }
        .humor-icon{ font-size:1.2rem; line-height:1 }
        .humor-text{ line-height:1.35 }
        .humor-close{
            position:absolute;
            top:.45rem;
            right:.55rem;
            border:none;
            background:transparent;
            cursor:pointer;
            font-size:1rem;
            color: var(--muted);
        }
        .humor-close:hover{ color: var(--text) }
        @keyframes humor-appear{ to{ opacity:1; transform: translateY(0) } }
        @media (prefers-reduced-motion: reduce){
            .humor-card{ animation:none; opacity:1; transform:none }
        }

        .minicaso{ border:1px solid var(--line); border-radius:12px; padding:14px; background: rgba(255,255,255,.02) }
        .mc-title{ margin:0 0 .35rem; font-weight:700 }
        .mc-esc{ color: var(--muted); margin:.25rem 0 .75rem }
        .mc-opts{ list-style:none; padding:0; margin:0; display:grid; gap:8px }
        .mc-btn{ padding:.6rem .8rem; border:1px solid var(--line); border-radius:10px; background:transparent; cursor:pointer }
        .mc-btn:hover{ border-color:var(--text) }
        .mc-ok{ border-color:#22c55e }
        .mc-no{ border-color:#ef4444 }
        .mc-retro{ margin-top:.75rem; color: var(--muted) }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar p-4">
        <div class="container mx-auto">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-brain text-3xl text-white floating-animation"></i>
                    <h1 class="text-2xl font-bold text-white">Psicometría Inmersiva — Edición 2025</h1>
                </div>
                <div class="hidden md:flex space-x-2" id="main-navigation">
                    <!-- Navegación se generará dinámicamente -->
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto p-6">
        
        <!-- Landing Page -->
        <section id="landing" class="section active">
            <div class="text-center py-16">
                <div class="mb-8">
                    <i class="fas fa-brain text-8xl text-blue-600 mb-4"></i>
                    <h1 class="text-5xl font-bold mb-4">Psicometría Inmersiva — Edición 2025</h1>
                    <p class="text-xl text-gray-600 max-w-2xl mx-auto">
                        Domina los conceptos fundamentales de psicometría con nuestra plataforma interactiva
                    </p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto">
                    <div class="card p-6 cursor-pointer" onclick="showSection('study-guide')">
                        <i class="fas fa-book text-4xl text-blue-600 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Guía de Estudio</h3>
                        <p class="text-gray-600">Ruta estructurada de aprendizaje</p>
                    </div>
                    
                    <div class="card p-6 cursor-pointer" onclick="showSection('videos')">
                        <i class="fas fa-video text-4xl text-red-600 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Zona de Videos</h3>
                        <p class="text-gray-600">Lecciones explicadas por expertos</p>
                    </div>
                    
                    <div class="card p-6 cursor-pointer" onclick="showSection('flashcards')">
                        <i class="fas fa-layer-group text-4xl text-green-600 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Flashcards</h3>
                        <p class="text-gray-600">Refuerza tu aprendizaje</p>
                    </div>
                    
                    <div class="card p-6 cursor-pointer" onclick="showSection('quiz')">
                        <i class="fas fa-question-circle text-4xl text-purple-600 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Cuestionario</h3>
                        <p class="text-gray-600">Pon a prueba tus conocimientos</p>
                    </div>
                    
                    <div class="card p-6 cursor-pointer" onclick="showSection('exam')">
                        <i class="fas fa-graduation-cap text-4xl text-orange-600 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Simulador</h3>
                        <p class="text-gray-600">Examen final de práctica</p>
                    </div>
                    
                    <div class="card p-6 cursor-pointer" onclick="showSection('dashboard')">
                        <i class="fas fa-tachometer-alt text-4xl text-indigo-600 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Panel de Progreso</h3>
                        <p class="text-gray-600">Ve tu avance completo</p>
                    </div>
                </div>
                
                <div class="mt-12">
                    <button id="hero-start" class="btn-success text-xl px-8 py-4" onclick="return false">
                        Iniciar recorrido guiado
                    </button>
                </div>
            </div>
        </section>
        
        <!-- Dashboard Section -->
        <section id="dashboard" class="section">
            <div class="mb-8">
                <h2 class="text-3xl font-bold mb-2">Tu Progreso de Estudio</h2>
                <p class="text-gray-600">¡Sigue así! Estás haciendo un excelente progreso en tu aprendizaje de psicometría.</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="card stat-card p-6">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-gray-700">Temas Completados</h3>
                            <p class="text-3xl font-bold text-green-600" id="completed-topics">0</p>
                        </div>
                        <div class="achievement-badge">
                            <i class="fas fa-check"></i>
                        </div>
                    </div>
                </div>
                
                <div class="card stat-card p-6">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-gray-700">Racha Actual</h3>
                            <p class="text-3xl font-bold text-orange-500" id="current-streak">0</p>
                            <p class="text-sm text-gray-500">días consecutivos</p>
                        </div>
                        <div class="achievement-badge">
                            <i class="fas fa-fire"></i>
                        </div>
                    </div>
                </div>
                
                <div class="card stat-card p-6">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-gray-700">Dominio General</h3>
                            <p class="text-3xl font-bold text-blue-600" id="overall-mastery">0</p>
                            <p class="text-sm text-gray-500">porcentaje</p>
                        </div>
                        <div class="achievement-badge">
                            <i class="fas fa-trophy"></i>
                        </div>
                    </div>
                </div>
                
                <div class="card stat-card p-6">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-gray-700">Próximo Desafío</h3>
                            <p class="text-lg font-bold text-purple-600" id="next-challenge">Teoría Clásica de los Tests</p>
                            <div class="badge mt-2">Por Comenzar</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card p-6">
                    <h3 class="text-xl font-bold mb-4">Progreso por Tema</h3>
                    <div class="space-y-4" id="topic-progress">
                        <!-- Progreso se cargará dinámicamente -->
                    </div>
                </div>
                
                <div class="card p-6">
                    <h3 class="text-xl font-bold mb-4">Estadísticas de Rendimiento</h3>
                    <div class="space-y-4" id="performance-stats">
                        <!-- Estadísticas se cargarán dinámicamente -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Study Guide Section -->
        <section id="study-guide" class="section">
            <div class="mb-8">
                <h2 class="text-3xl font-bold mb-2">Ruta de Aprendizaje</h2>
                <p class="text-gray-600">Sigue esta secuencia estructurada para dominar los conceptos fundamentales de psicometría.</p>
            </div>
            
            <div class="space-y-4" id="study-topics">
                <!-- Temas se cargarán dinámicamente -->
            </div>
        </section>

        <!-- Videos Section -->
        <section id="videos" class="section">
            <div class="mb-8">
                <h2 class="text-3xl font-bold mb-2">Lecciones en Video</h2>
                <p class="text-gray-600">Aprende con nuestra colección de videos educativos explicados por expertos.</p>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div>
                    <div id="prevideo-humor"></div>
                    <div class="youtube-player mb-4">
                        <iframe width="100%" height="400" src="https://www.youtube.com/embed/hriKlRXTF0A"
                                frameborder="0" allowfullscreen id="current-video"></iframe>
                    </div>

                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4">Notas del Video</h3>
                        <div class="space-y-3">
                            <textarea class="w-full h-32 p-3 border rounded-lg resize-none" 
                                      placeholder="Toma notas mientras ves el video..." id="video-notes"></textarea>
                            <button class="btn-success" onclick="saveNotes()">
                                <i class="fas fa-save mr-2"></i>Guardar Notas
                            </button>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-xl font-bold mb-4">Lista de Videos Disponibles</h3>
                    <div class="space-y-3" id="video-list">
                        <!-- Videos se cargarán dinámicamente -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Flashcards Section -->
        <section id="flashcards" class="section">
            <div class="mb-8">
                <h2 class="text-3xl font-bold mb-2">Tarjetas de Estudio</h2>
                <p class="text-gray-600">Refuerza tu aprendizaje con flashcards interactivas. Voltea las cartas para ver la respuesta.</p>
            </div>
            
            <div id="flashcards-loading" class="text-center py-8">
                <div class="loading-spinner"></div>
                <p class="mt-4 text-gray-600">Cargando flashcards...</p>
            </div>
            
            <div id="flashcards-content" class="hidden max-w-2xl mx-auto">
                <div class="flip-card mb-6" id="flashcard">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <div class="text-center">
                                <div class="text-4xl mb-4" id="card-icon">🧠</div>
                                <h3 class="text-2xl font-bold mb-4" id="card-question">Cargando...</h3>
                                <p class="text-lg">Haz clic en "Voltear" para ver la respuesta</p>
                            </div>
                        </div>
                        <div class="flip-card-back">
                            <div class="text-center">
                                <h3 class="text-xl font-bold mb-4">Respuesta</h3>
                                <p id="card-answer">Cargando...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card p-6">
                    <div class="flex justify-between items-center mb-4">
                        <div class="text-lg font-semibold">
                            <span id="current-card">1</span> de <span id="total-cards">0</span>
                        </div>
                        <div class="text-lg font-semibold text-green-600">
                            <span id="known-cards">0</span> conocidas
                        </div>
                    </div>
                    
                    <div class="flex flex-wrap gap-3 justify-center">
                        <button class="btn-primary" onclick="flipCard()">
                            <i class="fas fa-sync-alt mr-2"></i>Voltear
                        </button>
                        <button class="btn-success" onclick="nextCard()">
                            <i class="fas fa-arrow-right mr-2"></i>Siguiente
                        </button>
                        <button class="btn-primary" onclick="shuffleCards()">
                            <i class="fas fa-random mr-2"></i>Mezclar
                        </button>
                        <button class="btn-success" onclick="markAsKnown()">
                            <i class="fas fa-check mr-2"></i>Conocida
                        </button>
                    </div>
                    
                    <div class="mt-6">
                        <div class="progress-bg">
                            <div class="progress-bar" id="flashcard-progress" style="width: 0%"></div>
                        </div>
                        <p class="text-center mt-2 text-sm text-gray-600">Progreso en este mazo</p>
                    </div>
                    
                    <div class="mt-4 text-center">
                        <select class="p-2 border rounded-lg" onchange="changeDeck()" id="deck-selector">
                            <option value="">Selecciona un tema...</option>
                        </select>
                    </div>
                </div>
            </div>
        </section>

        <section id="mini-caso" class="section container"></section>

        <!-- Quiz Section -->
        <section id="quiz" class="section">
            <div class="mb-8">
                <h2 class="text-3xl font-bold mb-2">Práctica de Evaluación</h2>
                <p class="text-gray-600">Pon a prueba tus conocimientos con preguntas de opción múltiple y ejercicios prácticos.</p>
            </div>
            
            <div id="quiz-loading" class="text-center py-8">
                <div class="loading-spinner"></div>
                <p class="mt-4 text-gray-600">Cargando preguntas...</p>
            </div>
            
            <div id="quiz-content" class="hidden max-w-4xl mx-auto">
                <div class="card p-6 mb-6" id="quiz-container">
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold">Pregunta <span id="question-number">1</span> de <span id="total-questions">0</span></h3>
                            <div class="text-right">
                                <div class="text-lg font-bold text-green-600">Puntos: <span id="current-score">0</span></div>
                                <div class="text-sm text-gray-600">Pregunta: <span id="question-points">0</span> puntos</div>
                            </div>
                        </div>
                        
                        <div class="progress-bg mb-6">
                            <div class="progress-bar" id="quiz-progress" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div id="question-content">
                        <div class="flex items-center mb-4">
                            <span class="text-2xl mr-3" id="question-icon">🧠</span>
                            <h4 class="text-lg font-semibold" id="question-text">
                                Cargando pregunta...
                            </h4>
                        </div>
                        
                        <div class="space-y-3" id="options-container">
                            <!-- Opciones generadas dinámicamente -->
                        </div>
                        
                        <div class="mt-6 flex justify-between">
                            <button class="btn-primary" onclick="previousQuestion()" id="prev-btn" disabled>
                                <i class="fas fa-arrow-left mr-2"></i>Anterior
                            </button>
                            <button class="btn-success" onclick="submitAnswer()" id="submit-btn">
                                <i class="fas fa-check mr-2"></i>Enviar Respuesta
                            </button>
                            <button class="btn-primary" onclick="nextQuestion()" id="next-btn" style="display: none;">
                                <i class="fas fa-arrow-right mr-2"></i>Siguiente
                            </button>
                        </div>
                    </div>
                    
                    <div id="feedback-container" class="hidden mt-6 p-4 rounded-lg">
                        <div class="flex items-center mb-3">
                            <i class="fas fa-check-circle text-green-500 text-2xl mr-3" id="feedback-icon"></i>
                            <h4 class="text-lg font-bold" id="feedback-title">¡Correcto!</h4>
                        </div>
                        <p class="text-gray-700" id="feedback-text">
                            Esperando respuesta...
                        </p>
                        <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                            <p class="text-sm text-blue-800">
                                <strong>Explicación detallada:</strong> <span id="feedback-explanation"></span>
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="card p-6 text-center hidden" id="quiz-results">
                    <h3 class="text-2xl font-bold mb-4">¡Quiz Completado!</h3>
                    <div class="text-6xl mb-4" id="results-emoji">🎉</div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="card p-4">
                            <h4 class="font-bold mb-2">Puntaje Final</h4>
                            <div class="text-4xl font-bold text-green-600" id="final-score">0%</div>
                        </div>
                        <div class="card p-4">
                            <h4 class="font-bold mb-2">Preguntas Correctas</h4>
                            <div class="text-3xl font-bold text-blue-600">
                                <span id="correct-answers">0</span> / <span id="total-answers">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-x-3">
                        <button class="btn-primary" onclick="restartQuiz()">
                            <i class="fas fa-redo mr-2"></i>Reintentar
                        </button>
                        <button class="btn-success" onclick="showSection('dashboard')">
                            <i class="fas fa-home mr-2"></i>Volver al Panel
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                    <div class="card p-4 text-center">
                        <h4 class="font-bold mb-2">Selecciona un Tema</h4>
                        <select class="w-full p-2 border rounded-lg" onchange="changeQuizTopic()" id="quiz-topic">
                            <option value="">Selecciona un tema...</option>
                        </select>
                    </div>
                    
                    <div class="card p-4 text-center">
                        <h4 class="font-bold mb-2">Dificultad</h4>
                        <select class="w-full p-2 border rounded-lg" onchange="changeDifficulty()" id="quiz-difficulty">
                            <option value="all">Todas las dificultades</option>
                            <option value="easy">Básico</option>
                            <option value="medium">Intermedio</option>
                            <option value="hard">Avanzado</option>
                        </select>
                    </div>
                    
                    <div class="card p-4 text-center">
                        <h4 class="font-bold mb-2">Número de Preguntas</h4>
                        <select class="w-full p-2 border rounded-lg" onchange="changeQuestionCount()" id="question-count">
                            <option value="5">5 preguntas</option>
                            <option value="10" selected>10 preguntas</option>
                            <option value="15">15 preguntas</option>
                            <option value="20">20 preguntas</option>
                        </select>
                    </div>
                </div>
            </div>
        </section>

        <!-- Exam Simulator Section -->
        <section id="exam" class="section">
            <div class="mb-8">
                <h2 class="text-3xl font-bold mb-2">Examen de Simulación</h2>
                <p class="text-gray-600">Prepárate para el examen final con una simulación completa de todos los temas.</p>
            </div>
            
            <div class="max-w-4xl mx-auto">
                <div class="card p-8 text-center" id="exam-start">
                    <div class="mb-6">
                        <i class="fas fa-graduation-cap text-6xl text-blue-600 mb-4"></i>
                        <h3 class="text-2xl font-bold mb-4">Examen Final de Psicometría</h3>
                        <p class="text-gray-600 mb-6">
                            Este examen simula las condiciones reales del examen final. Tendrás 60 minutos para completar 50 preguntas de todos los temas del curso.
                        </p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="card p-4">
                            <h4 class="font-bold mb-2">Duración</h4>
                            <p class="text-2xl font-bold text-blue-600">60 minutos</p>
                        </div>
                        <div class="card p-4">
                            <h4 class="font-bold mb-2">Preguntas</h4>
                            <p class="text-2xl font-bold text-green-600">50 preguntas</p>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h4 class="font-bold mb-3">Distribución de Temas</h4>
                        <div class="space-y-2" id="exam-distribution">
                            <!-- Distribución se cargará dinámicamente -->
                        </div>
                    </div>
                    
                    <button class="btn-success text-xl px-8 py-4" onclick="startExam()">
                        <i class="fas fa-play mr-2"></i>Comenzar Examen
                    </button>
                </div>
                
                <div class="hidden" id="exam-active">
                    <div class="card p-6 mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold">Examen en Progreso</h3>
                            <div class="timer" id="exam-timer">60:00</div>
                        </div>
                        
                        <div class="flex justify-between items-center mb-4">
                            <div>Pregunta <span id="exam-question-number">1</span> de 50</div>
                            <div class="text-green-600 font-bold">Puntaje: <span id="exam-score">0</span></div>
                        </div>
                        
                        <div class="progress-bg mb-6">
                            <div class="progress-bar" id="exam-progress" style="width: 2%"></div>
                        </div>
                        
                        <div id="exam-question">
                            <div class="flex items-center mb-4">
                                <span class="text-2xl mr-3" id="exam-question-icon">🧠</span>
                                <h4 class="text-lg font-semibold" id="exam-question-text">
                                    Pregunta del examen aquí...
                                </h4>
                            </div>
                            
                            <div class="space-y-3" id="exam-options">
                                <!-- Opciones generadas dinámicamente -->
                            </div>
                        </div>
                        
                        <div class="mt-6 flex justify-between">
                            <button class="btn-primary" onclick="previousExamQuestion()" id="exam-prev-btn" disabled>
                                <i class="fas fa-arrow-left mr-2"></i>Anterior
                            </button>
                            <button class="btn-success" onclick="submitExamAnswer()" id="exam-submit-btn">
                                <i class="fas fa-check mr-2"></i>Siguiente Pregunta
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="card p-8 text-center hidden" id="exam-results">
                    <h3 class="text-2xl font-bold mb-4">¡Examen Completado!</h3>
                    <div class="text-6xl mb-4" id="exam-emoji">🎓</div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="card p-4">
                            <h4 class="font-bold mb-2">Puntaje Final</h4>
                            <div class="text-4xl font-bold text-green-600" id="exam-final-score">0%</div>
                        </div>
                        <div class="card p-4">
                            <h4 class="font-bold mb-2">Tiempo Utilizado</h4>
                            <div class="text-2xl font-bold text-blue-600" id="exam-time-used">00:00</div>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h4 class="font-bold mb-3">Desglose por Temas</h4>
                        <div class="space-y-2" id="exam-breakdown">
                            <!-- Desglose generado dinámicamente -->
                        </div>
                    </div>
                    
                    <div class="space-x-3">
                        <button class="btn-primary" onclick="restartExam()">
                            <i class="fas fa-redo mr-2"></i>Reintentar Examen
                        </button>
                        <button class="btn-success" onclick="showSection('dashboard')">
                            <i class="fas fa-home mr-2"></i>Volver al Panel
                        </button>
                    </div>
                </div>
            </div>
        </section>
        <section id="notebooklm" class="section container"></section>
    </main>

    <script>
        // Variables globales
        let flashcardData = {};
        let quizData = {};
        let dataLoaded = false;
        let currentSection = 'landing';
        let currentFlashcardDeck = '';
        let currentFlashcardIndex = 0;
        let knownFlashcards = 0;
        let isCardFlipped = false;
        let currentQuizTopic = '';
        let currentQuestionIndex = 0;
        let quizScore = 0;
        let selectedOption = -1;
        let examActive = false;
        let examTime = 3600;
        let examTimer;
        let examScore = 0;
        let examQuestionIndex = 0;

        // Configuración de temas
        const topics = [
            { id: 'tct', name: 'Teoría Clásica de los Tests', icon: '🧮', color: 'blue' },
            { id: 'confiabilidad', name: 'Confiabilidad', icon: '🔄', color: 'green' },
            { id: 'validez', name: 'Validez', icon: '🎯', color: 'purple' },
            { id: 'factorial', name: 'Análisis Factorial', icon: '🔍', color: 'orange' },
            { id: 'baremacion', name: 'Normalización y Baremación', icon: '📊', color: 'red' },
            { id: 'tri', name: 'Teoría de Respuesta a los Ítems', icon: '📈', color: 'indigo' }
        ];

        // Orden de navegación
        const navigationOrder = [
            { id: 'landing', title: 'Inicio', icon: 'fas fa-home' },
            { id: 'study-guide', title: 'Guía de Estudio', icon: 'fas fa-book' },
            { id: 'videos', title: 'Zona de Videos', icon: 'fas fa-video' },
            { id: 'flashcards', title: 'Flashcards', icon: 'fas fa-layer-group' },
            { id: 'quiz', title: 'Cuestionario', icon: 'fas fa-question-circle' },
            { id: 'exam', title: 'Simulador', icon: 'fas fa-graduation-cap' },
            { id: 'dashboard', title: 'Panel de Progreso', icon: 'fas fa-tachometer-alt' }
        ];

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            createNavigation();
            loadJSONData();
            initializeDashboard();
            loadLandingPage();
            setupEventListeners();
        });

        // Funciones de navegación
        function createNavigation() {
            const navContainer = document.getElementById('main-navigation');
            navContainer.innerHTML = '';
            
            navigationOrder.forEach((item, index) => {
                const button = document.createElement('button');
                button.className = `nav-item text-white ${index === 0 ? 'active' : ''}`;
                button.onclick = () => showSection(item.id);
                button.innerHTML = `
                    <i class="${item.icon} mr-2"></i>${item.title}
                `;
                navContainer.appendChild(button);
            });
        }

        function showSection(sectionId) {
            // Pausar videos al cambiar de sección
            const iframes = document.querySelectorAll('iframe[src*="youtube"]');
            iframes.forEach(iframe => {
                const src = iframe.src;
                iframe.src = '';
                iframe.src = src;
            });
            
            // Ocultar todas las secciones
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Mostrar la sección seleccionada
            const targetSection = document.getElementById(sectionId);
            if (!targetSection) return;
            targetSection.classList.add('active');

            if (sectionId === 'landing') {
                const notebookSection = document.getElementById('notebooklm');
                if (notebookSection) {
                    notebookSection.classList.add('active');
                }
            }
            
            // Actualizar navegación activa
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            currentSection = sectionId;
            
            // Actualizar progreso si es necesario
            if (sectionId === 'dashboard') {
                updateDashboard();
            }
        }

        // Carga de datos JSON
        async function loadJSONData() {
            const jsonFiles = [
                { key: 'tct', file: 'banco_tct.json' },
                { key: 'confiabilidad', file: 'banco_confiabilidad.json' },
                { key: 'validez', file: 'banco_validez.json' },
                { key: 'factorial', file: 'banco_factorial.json' },
                { key: 'baremacion', file: 'banco_baremacion.json' },
                { key: 'tri', file: 'banco_tri.json' }
            ];

            const flashcardFiles = [
                { key: 'tct', file: 'flashcards_tct.json' },
                { key: 'confiabilidad', file: 'flashcards_confiabilidad.json' },
                { key: 'validez', file: 'flashcards_validez.json' },
                { key: 'factorial', file: 'flashcards_factorial.json' },
                { key: 'baremacion', file: 'flashcards_baremacion.json' },
                { key: 'tri', file: 'flashcards_tri.json' }
            ];

            // Cargar datos de quizzes
            for (const item of jsonFiles) {
                try {
                    const response = await fetch(item.file);
                    if (response.ok) {
                        quizData[item.key] = await response.json();
                    } else {
                        console.warn(`Archivo no encontrado: ${item.file}`);
                    }
                } catch (error) {
                    console.error(`Error al cargar ${item.file}:`, error);
                }
            }

            // Cargar datos de flashcards
            for (const item of flashcardFiles) {
                try {
                    const response = await fetch(item.file);
                    if (response.ok) {
                        const data = await response.json();
                        flashcardData[item.key] = data.map(card => ({
                            question: card.front,
                            answer: card.back,
                            icon: card.icon || '🧠',
                            topic: card.topic || 'General',
                            difficulty: card.difficulty || 'medium',
                            points: card.points || 10
                        }));
                    } else {
                        console.warn(`Archivo no encontrado: ${item.file}`);
                    }
                } catch (error) {
                    console.error(`Error al cargar ${item.file}:`, error);
                }
            }

            // Si no se cargaron datos, usar datos de muestra
            if (Object.keys(quizData).length === 0 && Object.keys(flashcardData).length === 0) {
                loadSampleData();
            }

            dataLoaded = true;
            hideLoadingSpinners();
            initializeContent();
        }

        function loadSampleData() {
            // Datos de muestra para flashcards
            flashcardData = {
                tct: [
                    {question: "¿Qué es la Teoría Clásica de los Tests?", answer: "Modelo que postula que la puntuación observada (X) es la suma de la puntuación verdadera (T) más el error de medición (E): X = T + E", icon: "🧮", topic: "TCT", difficulty: "easy", points: 10},
                    {question: "¿Cuáles son los supuestos básicos de la TCT?", answer: "1) El error tiene media cero, 2) El error no se correlaciona con la puntuación verdadera, 3) Los errores de diferentes mediciones no se correlacionan", icon: "📊", topic: "Supuestos TCT", difficulty: "medium", points: 20}
                ],
                confiabilidad: [
                    {question: "¿Qué es la confiabilidad?", answer: "Grado en que las puntuaciones de un test son consistentes, estables y libres de error de medición", icon: "🔄", topic: "Confiabilidad", difficulty: "easy", points: 10}
                ],
                validez: [
                    {question: "¿Qué es la validez?", answer: "Grado en que las interpretaciones y usos de las puntuaciones de un test son apropiadas y precisas", icon: "🎯", topic: "Validez", difficulty: "easy", points: 10}
                ],
                factorial: [
                    {question: "¿Qué es el análisis factorial?", answer: "Técnica estadística para identificar las dimensiones o factores subyacentes en un conjunto de variables", icon: "🔍", topic: "Análisis Factorial", difficulty: "easy", points: 10}
                ],
                baremacion: [
                    {question: "¿Qué es la baremación?", answer: "Proceso que convierte puntajes brutos en puntajes normados, comparando al individuo con una muestra normativa", icon: "📊", topic: "Baremación", difficulty: "easy", points: 10}
                ],
                tri: [
                    {question: "¿Qué es la Teoría de Respuesta a los Ítems?", answer: "Modelo que relaciona la probabilidad de responder correctamente con las características del ítem y la habilidad del examinado", icon: "📈", topic: "TRI", difficulty: "medium", points: 20}
                ]
            };

            // Datos de muestra para quizzes
            quizData = {
                tct: [
                    {
                        type: "multiple-choice",
                        question: "¿Cuál de las siguientes fórmulas representa correctamente la Teoría Clásica de los Tests?",
                        options: ["X = T × E", "X = T + E", "X = T - E", "X = T ÷ E"],
                        answer: "X = T + E",
                        correct: 1,
                        explanation: "La fórmula correcta es X = T + E, donde X es la puntuación observada, T es la puntuación verdadera y E es el error de medición.",
                        difficulty: "easy",
                        icon: "🧮",
                        topic: "TCT",
                        points: 10
                    },
                    {
                        type: "fill-in-the-blank",
                        question: "La proporción de varianza de una variable explicada por los factores comunes se llama ________.",
                        answer: "comunalidad",
                        explanation: "La comunalidad refleja cuánta varianza de una variable está asociada con los factores comunes.",
                        difficulty: "medium",
                        icon: "⚙️",
                        topic: "Comunalidad",
                        points: 20
                    }
                ],
                confiabilidad: [
                    {
                        type: "multiple-choice",
                        question: "¿Qué coeficiente de confiabilidad se considera aceptable para decisiones educativas?",
                        options: ["0.60", "0.70", "0.80", "0.90"],
                        answer: "0.80",
                        correct: 2,
                        explanation: "Para decisiones educativas importantes, se recomienda un coeficiente de confiabilidad de al menos 0.80.",
                        difficulty: "easy",
                        icon: "📈",
                        topic: "Confiabilidad",
                        points: 10
                    }
                ],
                validez: [
                    {
                        type: "multiple-choice",
                        question: "¿Cuál es el tipo de validez más importante para un test de inteligencia?",
                        options: ["Validez de contenido", "Validez de criterio", "Validez de constructo", "Validez facial"],
                        answer: "Validez de constructo",
                        correct: 2,
                        explanation: "La validez de constructo es fundamental para tests de inteligencia porque evalúa si realmente está midiendo el constructo teórico de inteligencia.",
                        difficulty: "medium",
                        icon: "🎯",
                        topic: "Validez de Constructo",
                        points: 20
                    }
                ],
                factorial: [
                    {
                        type: "association",
                        question: "Empareja los conceptos con sus definiciones:",
                        pairs: [
                            { left: "Factor G", right: "Factor general de inteligencia propuesto por Spearman" },
                            { left: "Análisis Factorial Exploratorio", right: "Técnica para identificar factores subyacentes sin hipótesis previas" },
                            { left: "Carga Factorial", right: "Correlación entre una variable y un factor" },
                            { left: "Comunalidad", right: "Proporción de varianza explicada por los factores comunes" }
                        ],
                        explanation: "Estos conceptos son fundamentales para entender el análisis factorial.",
                        difficulty: "medium",
                        icon: "🔍",
                        topic: "Conceptos Factoriales",
                        points: 30
                    }
                ],
                baremacion: [
                    {
                        type: "multiple-choice",
                        question: "¿Qué transformación convierte una puntuación X en una puntuación Z?",
                        options: ["Z = (X - μ) / σ", "Z = X + μ - σ", "Z = X × μ ÷ σ", "Z = X - μ + σ"],
                        answer: "Z = (X - μ) / σ",
                        correct: 0,
                        explanation: "La puntuación Z indica cuántas desviaciones estándar está un puntaje sobre o bajo la media.",
                        difficulty: "medium",
                        icon: "🧮",
                        topic: "Puntuación Z",
                        points: 20
                    }
                ],
                tri: [
                    {
                        type: "multiple-choice",
                        question: "¿Qué ventaja principal tiene TRI sobre TCT?",
                        options: ["Es más simple", "No requiere cálculos", "Invarianza de parámetros", "Menor costo"],
                        answer: "Invarianza de parámetros",
                        correct: 2,
                        explanation: "La invarianza de parámetros en TRI permite que las características del ítem sean independientes de la muestra utilizada.",
                        difficulty: "hard",
                        icon: "🔬",
                        topic: "TRI",
                        points: 30
                    }
                ]
            };
        }

        function hideLoadingSpinners() {
            document.getElementById('flashcards-loading').style.display = 'none';
            document.getElementById('quiz-loading').style.display = 'none';
            document.getElementById('flashcards-content').classList.remove('hidden');
            document.getElementById('quiz-content').classList.remove('hidden');
        }

        function initializeContent() {
            populateSelectors();
            updateFlashcard();
            loadQuestion();
            initializeStudyGuide();
            initializeVideos();
            initializeExam();
        }

        function populateSelectors() {
            // Llenar selectores de temas
            const deckSelector = document.getElementById('deck-selector');
            const quizTopicSelector = document.getElementById('quiz-topic');
            
            deckSelector.innerHTML = '<option value="">Selecciona un tema...</option>';
            quizTopicSelector.innerHTML = '<option value="">Selecciona un tema...</option>';
            
            topics.forEach(topic => {
                if (flashcardData[topic.id]) {
                    deckSelector.innerHTML += `<option value="${topic.id}">${topic.name}</option>`;
                }
                if (quizData[topic.id]) {
                    quizTopicSelector.innerHTML += `<option value="${topic.id}">${topic.name}</option>`;
                }
            });
        }

        // Funciones del dashboard
        function initializeDashboard() {
            const savedProgress = JSON.parse(localStorage.getItem('studyProgress') || '{}');
            
            // Inicializar con valores en 0 si no hay datos guardados
            document.getElementById('completed-topics').textContent = savedProgress.completedTopics || 0;
            document.getElementById('current-streak').textContent = savedProgress.currentStreak || 0;
            document.getElementById('overall-mastery').textContent = savedProgress.overallMastery || 0;
            
            updateTopicProgress();
            updatePerformanceStats();
        }

        function updateDashboard() {
            const savedProgress = JSON.parse(localStorage.getItem('studyProgress') || '{}');
            initializeDashboard();
        }

        function updateTopicProgress() {
            const container = document.getElementById('topic-progress');
            const savedProgress = JSON.parse(localStorage.getItem('studyProgress') || '{}');
            const topicProgress = savedProgress.topicProgress || {};
            
            container.innerHTML = '';
            
            topics.forEach(topic => {
                const progress = topicProgress[topic.id] || 0;
                const isCompleted = progress >= 80;
                
                container.innerHTML += `
                    <div>
                        <div class="flex justify-between mb-2">
                            <span class="font-medium">${topic.icon} ${topic.name}</span>
                            <span class="font-bold ${isCompleted ? 'text-green-600' : progress > 0 ? 'text-orange-600' : 'text-red-600'}">${progress}%</span>
                        </div>
                        <div class="progress-bg">
                            <div class="progress-bar" style="width: ${progress}%"></div>
                        </div>
                    </div>
                `;
            });
        }

        function updatePerformanceStats() {
            const container = document.getElementById('performance-stats');
            const savedProgress = JSON.parse(localStorage.getItem('studyProgress') || '{}');
            const stats = savedProgress.performanceStats || {
                correctAnswers: 0,
                averageTime: 0,
                bestFlashcardScore: 0,
                videosCompleted: 0,
                studyDays: 0
            };
            
            container.innerHTML = `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <span class="font-medium">Respuestas Correctas</span>
                    <span class="text-green-600 font-bold">${stats.correctAnswers}%</span>
                </div>
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <span class="font-medium">Tiempo Promedio por Quiz</span>
                    <span class="text-blue-600 font-bold">${stats.averageTime} min</span>
                </div>
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <span class="font-medium">Mejor Puntaje Flashcards</span>
                    <span class="text-purple-600 font-bold">${stats.bestFlashcardScore}%</span>
                </div>
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <span class="font-medium">Vídeos Completados</span>
                    <span class="text-orange-600 font-bold">${stats.videosCompleted}/6</span>
                </div>
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <span class="font-medium">Días de Estudio</span>
                    <span class="text-red-600 font-bold">${stats.studyDays}/30</span>
                </div>
            `;
        }

        // Funciones de la guía de estudio
        function initializeStudyGuide() {
            const container = document.getElementById('study-topics');
            const savedProgress = JSON.parse(localStorage.getItem('studyProgress') || '{}');
            const topicProgress = savedProgress.topicProgress || {};
            
            container.innerHTML = '';
            
            topics.forEach((topic, index) => {
                const progress = topicProgress[topic.id] || 0;
                const isCompleted = progress >= 80;
                const isInProgress = progress > 0 && progress < 80;
                
                let statusBadge, statusColor, statusIcon;
                
                if (isCompleted) {
                    statusBadge = 'Completado';
                    statusColor = 'green';
                    statusIcon = 'check';
                } else if (isInProgress) {
                    statusBadge = 'En Progreso';
                    statusColor = 'orange';
                    statusIcon = 'clock';
                } else {
                    statusBadge = 'Pendiente';
                    statusColor = 'gray';
                    statusIcon = 'clock';
                }
                
                container.innerHTML += `
                    <div class="card topic-item ${isCompleted ? 'topic-completed' : ''} p-6 cursor-pointer" onclick="toggleTopic('${topic.id}')">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-${statusColor}-500 rounded-full flex items-center justify-center">
                                    <i class="fas fa-${statusIcon} text-white text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold">${index + 1}. ${topic.name}</h3>
                                    <p class="text-gray-600">Conceptos fundamentales de ${topic.name.toLowerCase()}</p>
                                    <div class="flex items-center mt-2">
                                        <span class="bg-${statusColor}-500 text-white px-3 py-1 rounded-full text-sm font-semibold">${statusBadge}</span>
                                        <span class="ml-2 text-sm text-gray-500">Progreso: ${progress}%</span>
                                    </div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-down text-gray-400"></i>
                        </div>
                        <div class="mt-4 hidden" id="${topic.id}-content">
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="font-bold mb-2">Contenido del tema:</h4>
                                <div class="progress-bg mb-4">
                                    <div class="progress-bar" style="width: ${progress}%"></div>
                                </div>
                                <p class="text-sm text-gray-600 mb-3">Has completado el ${progress}% de este tema</p>
                                <button class="btn-primary" onclick="startTopic('${topic.id}')">
                                    ${isCompleted ? 'Revisar' : isInProgress ? 'Continuar' : 'Comenzar'}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        function toggleTopic(topicId) {
            const content = document.getElementById(topicId + '-content');
            const icon = event.currentTarget.querySelector('.fa-chevron-down');
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.style.transform = 'rotate(180deg)';
            } else {
                content.classList.add('hidden');
                icon.style.transform = 'rotate(0deg)';
            }
        }

        function startTopic(topicId) {
            // Guardar progreso y redirigir al quiz correspondiente
            showSection('quiz');
            document.getElementById('quiz-topic').value = topicId;
            changeQuizTopic();
        }

        // Funciones de videos
        function initializeVideos() {
            const videos = [
                { id: 'hriKlRXTF0A', title: 'Teoría Clásica de los Tests', description: 'Fundamentos y aplicaciones básicas', status: 'Completado' },
                { id: 'aeENe9swI8E', title: 'La Búsqueda de la Consistencia', description: 'Conceptos de confiabilidad', status: 'Completado' },
                { id: 'vrU6jJ80_UU', title: 'Entendiendo la Validez', description: 'Tipos y evidencia de validez', status: 'Completado' },
                { id: 'v_pD5lwpISI', title: 'Análisis Factorial - La estructura de la Mente', description: 'Evidencia de la estructura interna', status: 'En Progreso' },
                { id: 'hl8LNar2oys', title: 'Dándole Sentido a un Puntaje', description: 'Normalización y baremación', status: 'Pendiente' },
                { id: 'BRCeQo9SmSE', title: 'Teoría de Respuesta a los Ítems', description: 'Modelos modernos de medición', status: 'Pendiente' }
            ];
            
            const container = document.getElementById('video-list');
            container.innerHTML = '';
            
            videos.forEach(video => {
                const statusClass = video.status === 'Completado' ? 'green' : 
                                  video.status === 'En Progreso' ? 'orange' : 'gray';
                
                container.innerHTML += `
                    <div class="card p-4 cursor-pointer hover:bg-gray-50" onclick="changeVideo('${video.id}', '${video.title}')">
                        <div class="flex items-center space-x-3">
                            <div class="w-16 h-12 bg-red-600 rounded flex items-center justify-center">
                                <i class="fas fa-play text-white"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-bold">${video.title}</h4>
                                <p class="text-sm text-gray-600">${video.description}</p>
                                <span class="bg-${statusClass}-500 text-white px-2 py-1 rounded-full text-xs font-semibold">${video.status}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        function changeVideo(videoId, title) {
            const iframe = document.getElementById('current-video');
            iframe.src = `https://www.youtube.com/embed/${videoId}`;
            
            // Actualizar notas si existen
            const savedNotes = localStorage.getItem(`notes-${videoId}`);
            if (savedNotes) {
                document.getElementById('video-notes').value = savedNotes;
            } else {
                document.getElementById('video-notes').value = '';
            }
            
            // Actualizar progreso
            updateVideoProgress(videoId);
        }

        function updateVideoProgress(videoId) {
            const savedProgress = JSON.parse(localStorage.getItem('studyProgress') || '{}');
            savedProgress.videosWatched = savedProgress.videosWatched || [];
            
            if (!savedProgress.videosWatched.includes(videoId)) {
                savedProgress.videosWatched.push(videoId);
                savedProgress.videosCompleted = savedProgress.videosWatched.length;
                localStorage.setItem('studyProgress', JSON.stringify(savedProgress));
                updatePerformanceStats();
            }
        }

        function saveNotes() {
            const notes = document.getElementById('video-notes').value;
            const videoId = document.getElementById('current-video').src.split('/').pop().split('?')[0];
            localStorage.setItem(`notes-${videoId}`, notes);
            
            // Mostrar mensaje de confirmación
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-check mr-2"></i>¡Guardado!';
            button.classList.remove('btn-success');
            button.classList.add('btn-primary');
            
            setTimeout(() => {
                button.innerHTML = originalText;
                button.classList.remove('btn-primary');
                button.classList.add('btn-success');
            }, 2000);
        }

        // Funciones de flashcards
        function flipCard() {
            const card = document.getElementById('flashcard');
            card.classList.toggle('flipped');
            isCardFlipped = !isCardFlipped;
        }

        function nextCard() {
            const deck = flashcardData[currentFlashcardDeck];
            if (!deck || deck.length === 0) return;
            
            currentFlashcardIndex = (currentFlashcardIndex + 1) % deck.length;
            updateFlashcard();
            
            // Desvoltear la carta
            const card = document.getElementById('flashcard');
            card.classList.remove('flipped');
            isCardFlipped = false;
        }

        function shuffleCards() {
            const deck = [...flashcardData[currentFlashcardDeck]];
            if (!deck || deck.length === 0) return;
            
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            flashcardData[currentFlashcardDeck] = deck;
            currentFlashcardIndex = 0;
            updateFlashcard();
            
            // Desvoltear la carta
            const card = document.getElementById('flashcard');
            card.classList.remove('flipped');
            isCardFlipped = false;
        }

        function markAsKnown() {
            knownFlashcards++;
            document.getElementById('known-cards').textContent = knownFlashcards;
            
            // Actualizar progreso
            updateFlashcardProgress();
            nextCard();
        }

        function changeDeck() {
            const selector = document.getElementById('deck-selector');
            currentFlashcardDeck = selector.value;
            currentFlashcardIndex = 0;
            knownFlashcards = 0;
            updateFlashcard();
            
            // Desvoltear la carta
            const card = document.getElementById('flashcard');
            card.classList.remove('flipped');
            isCardFlipped = false;
        }

        function updateFlashcard() {
            const deck = flashcardData[currentFlashcardDeck];
            if (!deck || deck.length === 0) {
                document.getElementById('card-question').textContent = 'Selecciona un tema para comenzar';
                document.getElementById('card-answer').textContent = 'Elige un mazo de flashcards del menú desplegable';
                document.getElementById('current-card').textContent = '0';
                document.getElementById('total-cards').textContent = '0';
                document.getElementById('flashcard-progress').style.width = '0%';
                return;
            }
            
            const card = deck[currentFlashcardIndex];
            
            document.getElementById('card-icon').textContent = card.icon || '🧠';
            document.getElementById('card-question').textContent = card.question;
            document.getElementById('card-answer').textContent = card.answer;
            document.getElementById('current-card').textContent = currentFlashcardIndex + 1;
            document.getElementById('total-cards').textContent = deck.length;
            document.getElementById('known-cards').textContent = knownFlashcards;
            
            const progress = ((currentFlashcardIndex + 1) / deck.length) * 100;
            document.getElementById('flashcard-progress').style.width = progress + '%';
        }

        function updateFlashcardProgress() {
            const savedProgress = JSON.parse(localStorage.getItem('studyProgress') || '{}');
            const deck = flashcardData[currentFlashcardDeck];
            
            if (deck && deck.length > 0) {
                const progress = (knownFlashcards / deck.length) * 100;
                savedProgress.flashcardProgress = savedProgress.flashcardProgress || {};
                savedProgress.flashcardProgress[currentFlashcardDeck] = progress;
                
                // Actualizar mejor puntaje
                savedProgress.performanceStats = savedProgress.performanceStats || {};
                savedProgress.performanceStats.bestFlashcardScore = Math.max(
                    savedProgress.performanceStats.bestFlashcardScore || 0,
                    progress
                );
                
                localStorage.setItem('studyProgress', JSON.stringify(savedProgress));
            }
        }

        // Funciones del quiz
        function selectOption(index) {
            // Limpiar selecciones previas
            document.querySelectorAll('.quiz-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Marcar opción seleccionada
            document.querySelectorAll('.quiz-option')[index].classList.add('selected');
            selectedOption = index;
            
            // Habilitar botón de envío
            document.getElementById('submit-btn').disabled = false;
        }

        function submitAnswer() {
            const quiz = quizData[currentQuizTopic];
            if (!quiz || quiz.length === 0) return;
            
            const question = quiz[currentQuestionIndex % quiz.length];
            let isCorrect = false;
            
            if (question.type === 'multiple-choice') {
                if (selectedOption === -1) return;
                isCorrect = selectedOption === question.correct;
            } else if (question.type === 'fill-in-the-blank') {
                const answer = document.getElementById('fill-answer').value.trim();
                isCorrect = answer.toLowerCase() === question.answer.toLowerCase();
            }
            
            // Mostrar retroalimentación
            const feedbackContainer = document.getElementById('feedback-container');
            const feedbackIcon = document.getElementById('feedback-icon');
            const feedbackTitle = document.getElementById('feedback-title');
            const feedbackText = document.getElementById('feedback-text');
            const feedbackExplanation = document.getElementById('feedback-explanation');
            
            if (isCorrect) {
                feedbackIcon.className = 'fas fa-check-circle text-green-500 text-2xl mr-3';
                feedbackTitle.textContent = '¡Correcto!';
                feedbackTitle.className = 'text-lg font-bold text-green-600';
                quizScore += question.points;
                document.getElementById('current-score').textContent = quizScore;
            } else {
                feedbackIcon.className = 'fas fa-times-circle text-red-500 text-2xl mr-3';
                feedbackTitle.textContent = 'Incorrecto';
                feedbackTitle.className = 'text-lg font-bold text-red-600';
            }
            
            feedbackText.textContent = isCorrect ? '¡Buen trabajo!' : 'Sigue practicando.';
            feedbackExplanation.textContent = question.explanation;
            feedbackContainer.classList.remove('hidden');
            
            // Marcar opciones correctas/incorrectas
            if (question.type === 'multiple-choice') {
                document.querySelectorAll('.quiz-option').forEach((option, index) => {
                    if (index === question.correct) {
                        option.classList.add('correct');
                    } else if (index === selectedOption && !isCorrect) {
                        option.classList.add('incorrect');
                    }
                });
            }
            
            // Actualizar botones
            document.getElementById('submit-btn').style.display = 'none';
            document.getElementById('next-btn').style.display = 'inline-block';
            
            // Actualizar estadísticas
            updateQuizStats(isCorrect);
        }

        function nextQuestion() {
            currentQuestionIndex++;
            
            const quiz = quizData[currentQuizTopic];
            if (!quiz || currentQuestionIndex >= quiz.length) {
                showQuizResults();
                return;
            }
            
            loadQuestion();
            
            // Ocultar retroalimentación
            document.getElementById('feedback-container').classList.add('hidden');
            document.getElementById('submit-btn').style.display = 'inline-block';
            document.getElementById('next-btn').style.display = 'none';
            
            selectedOption = -1;
        }

        function loadQuestion() {
            const quiz = quizData[currentQuizTopic];
            if (!quiz || quiz.length === 0) {
                document.getElementById('question-text').textContent = 'Selecciona un tema para comenzar';
                return;
            }
            
            const question = quiz[currentQuestionIndex % quiz.length];
            
            document.getElementById('question-icon').textContent = question.icon || '🧠';
            document.getElementById('question-number').textContent = currentQuestionIndex + 1;
            document.getElementById('question-text').textContent = question.question;
            document.getElementById('question-points').textContent = question.points || 10;
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            if (question.type === 'multiple-choice') {
                question.options.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'quiz-option p-4 border rounded-lg cursor-pointer';
                    optionDiv.onclick = () => selectOption(index);
                    
                    optionDiv.innerHTML = `
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="quiz-option" class="mr-3">
                            <span>${option}</span>
                        </label>
                    `;
                    
                    optionsContainer.appendChild(optionDiv);
                });
            } else if (question.type === 'fill-in-the-blank') {
                optionsContainer.innerHTML = `
                    <div class="p-4 border rounded-lg">
                        <input type="text" id="fill-answer" class="w-full p-3 border rounded-lg fill-input" 
                               placeholder="Escribe tu respuesta aquí..." 
                               onkeyup="checkFillAnswer()">
                        <div id="fill-feedback" class="hidden mt-3 p-3 rounded-lg"></div>
                    </div>
                `;
            } else if (question.type === 'association') {
                createAssociationQuestion(question.pairs);
            }
            
            const progress = ((currentQuestionIndex + 1) / quiz.length) * 100;
            document.getElementById('quiz-progress').style.width = progress + '%';
            document.getElementById('total-questions').textContent = quiz.length;
            
            // Deshabilitar botón de envío inicialmente
            document.getElementById('submit-btn').disabled = true;
        }

        function checkFillAnswer() {
            const answer = document.getElementById('fill-answer').value.trim();
            const quiz = quizData[currentQuizTopic];
            const question = quiz[currentQuestionIndex % quiz.length];
            const feedback = document.getElementById('fill-feedback');
            
            if (answer.length > 0) {
                feedback.classList.remove('hidden');
                
                if (answer.toLowerCase() === question.answer.toLowerCase()) {
                    feedback.className = 'mt-3 p-3 rounded-lg bg-green-100 text-green-800';
                    feedback.innerHTML = '<i class="fas fa-check mr-2"></i>¡Respuesta correcta!';
                    document.getElementById('submit-btn').disabled = false;
                    document.getElementById('fill-answer').classList.add('correct');
                    document.getElementById('fill-answer').classList.remove('incorrect');
                } else {
                    feedback.className = 'mt-3 p-3 rounded-lg bg-red-100 text-red-800';
                    feedback.innerHTML = '<i class="fas fa-times mr-2"></i>Respuesta incorrecta. Inténtalo de nuevo.';
                    document.getElementById('submit-btn').disabled = true;
                    document.getElementById('fill-answer').classList.add('incorrect');
                    document.getElementById('fill-answer').classList.remove('correct');
                }
            } else {
                feedback.classList.add('hidden');
                document.getElementById('submit-btn').disabled = true;
                document.getElementById('fill-answer').classList.remove('correct', 'incorrect');
            }
        }

        function createAssociationQuestion(pairs) {
            const container = document.getElementById('options-container');
            
            // Mezclar las opciones
            const shuffledPairs = [...pairs].sort(() => Math.random() - 0.5);
            const shuffledRights = [...pairs].sort(() => Math.random() - 0.5);
            
            let leftItems = '';
            let rightItems = '';
            
            shuffledPairs.forEach((pair, index) => {
                leftItems += `
                    <div class="association-item" draggable="true" data-id="${pairs.findIndex(p => p.left === pair.left)}">
                        ${pair.left}
                    </div>
                `;
            });
            
            shuffledRights.forEach((pair, index) => {
                rightItems += `
                    <div class="association-target" data-match="${pairs.findIndex(p => p.right === pair.right)}">
                        <div class="target-label">${pair.right}</div>
                    </div>
                `;
            });
            
            container.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <h4 class="font-bold mb-4">Arrastra desde aquí:</h4>
                        <div class="space-y-2" id="left-items">${leftItems}</div>
                    </div>
                    <div>
                        <h4 class="font-bold mb-4">Empareja aquí:</h4>
                        <div class="space-y-2" id="right-items">${rightItems}</div>
                    </div>
                </div>
                <button class="btn-success mt-4" onclick="checkAssociations()">
                    <i class="fas fa-check mr-2"></i>Verificar Emparejamiento
                </button>
                <div id="association-feedback" class="hidden mt-3 p-3 rounded-lg"></div>
            `;
            
            initializeDragAndDrop();
        }

        function initializeDragAndDrop() {
            const items = document.querySelectorAll('.association-item');
            const targets = document.querySelectorAll('.association-target');
            
            items.forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', e.target.dataset.id);
                    e.target.classList.add('dragging');
                });
                
                item.addEventListener('dragend', (e) => {
                    e.target.classList.remove('dragging');
                });
            });
            
            targets.forEach(target => {
                target.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    target.classList.add('drag-over');
                });
                
                target.addEventListener('dragleave', (e) => {
                    target.classList.remove('drag-over');
                });
                
                target.addEventListener('drop', (e) => {
                    e.preventDefault();
                    target.classList.remove('drag-over');
                    
                    const itemId = e.dataTransfer.getData('text/plain');
                    const draggedItem = document.querySelector(`[data-id="${itemId}"]`);
                    
                    // Verificar si ya hay un elemento en el target
                    const existingItem = target.querySelector('.association-item');
                    if (existingItem && existingItem !== draggedItem) {
                        // Mover el elemento existente de vuelta a la lista izquierda
                        document.getElementById('left-items').appendChild(existingItem);
                    }
                    
                    // Mover el nuevo elemento al target
                    target.appendChild(draggedItem);
                    
                    // Verificar si es correcto
                    if (target.dataset.match === itemId) {
                        draggedItem.classList.add('bg-green-100');
                        draggedItem.classList.remove('bg-red-100');
                        target.classList.add('correct');
                        target.classList.remove('incorrect');
                    } else {
                        draggedItem.classList.add('bg-red-100');
                        draggedItem.classList.remove('bg-green-100');
                        target.classList.add('incorrect');
                        target.classList.remove('correct');
                    }
                    
                    checkAllAssociations();
                });
            });
        }

        function checkAllAssociations() {
            const targets = document.querySelectorAll('.association-target');
            const total = targets.length;
            let correct = 0;
            
            targets.forEach(target => {
                const item = target.querySelector('.association-item');
                if (item && target.dataset.match === item.dataset.id) {
                    correct++;
                }
            });
            
            const feedback = document.getElementById('association-feedback');
            if (feedback) {
                if (correct === total) {
                    feedback.className = 'hidden mt-3 p-3 rounded-lg bg-green-100 text-green-800';
                    feedback.innerHTML = '<i class="fas fa-check mr-2"></i>¡Todas las asociaciones son correctas!';
                    document.getElementById('submit-btn').disabled = false;
                } else {
                    feedback.className = 'hidden mt-3 p-3 rounded-lg bg-blue-100 text-blue-800';
                    feedback.innerHTML = `<i class="fas fa-info mr-2"></i>Llevas ${correct} de ${total} correctas.`;
                }
            }
        }

        function checkAssociations() {
            const targets = document.querySelectorAll('.association-target');
            const total = targets.length;
            let correct = 0;
            
            targets.forEach(target => {
                const item = target.querySelector('.association-item');
                if (item && target.dataset.match === item.dataset.id) {
                    correct++;
                }
            });
            
            const feedback = document.getElementById('association-feedback');
            feedback.classList.remove('hidden');
            
            if (correct === total) {
                feedback.className = 'mt-3 p-3 rounded-lg bg-green-100 text-green-800';
                feedback.innerHTML = '<i class="fas fa-check mr-2"></i>¡Excelente! Todas las asociaciones son correctas.';
                document.getElementById('submit-btn').disabled = false;
            } else {
                feedback.className = 'mt-3 p-3 rounded-lg bg-orange-100 text-orange-800';
                feedback.innerHTML = `<i class="fas fa-exclamation mr-2"></i>Tienes ${correct} de ${total} correctas. Revisa tus respuestas.`;
                document.getElementById('submit-btn').disabled = true;
            }
        }

        function updateQuizStats(isCorrect) {
            const savedProgress = JSON.parse(localStorage.getItem('studyProgress') || '{}');
            savedProgress.quizStats = savedProgress.quizStats || {
                totalQuestions: 0,
                correctAnswers: 0,
                totalTime: 0
            };
            
            savedProgress.quizStats.totalQuestions++;
            if (isCorrect) savedProgress.quizStats.correctAnswers++;
            
            // Calcular porcentaje de respuestas correctas
            const correctPercentage = Math.round((savedProgress.quizStats.correctAnswers / savedProgress.quizStats.totalQuestions) * 100);
            
            savedProgress.performanceStats = savedProgress.performanceStats || {};
            savedProgress.performanceStats.correctAnswers = correctPercentage;
            
            localStorage.setItem('studyProgress', JSON.stringify(savedProgress));
            updatePerformanceStats();
        }

        function showQuizResults() {
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('quiz-results').classList.remove('hidden');
            
            const quiz = quizData[currentQuizTopic];
            const totalQuestions = quiz ? quiz.length : 0;
            const maxScore = quiz ? quiz.reduce((sum, q) => sum + (q.points || 10), 0) : totalQuestions * 10;
            const percentage = totalQuestions > 0 ? Math.round((quizScore / maxScore) * 100) : 0;
            const correctAnswers = quizScore > 0 ? Math.round(quizScore / 10) : 0;
            
            document.getElementById('final-score').textContent = percentage + '%';
            document.getElementById('correct-answers').textContent = correctAnswers;
            document.getElementById('total-answers').textContent = totalQuestions;
            
            // Actualizar progreso del tema
            updateTopicProgressFromQuiz(percentage);
            
            // Actualizar estadísticas del dashboard
            const savedProgress = JSON.parse(localStorage.getItem('studyProgress') || '{}');
            const currentMastery = savedProgress.overallMastery || 0;
            const newMastery = Math.min(100, currentMastery + Math.floor(percentage / 10));
            
            savedProgress.overallMastery = newMastery;
            savedProgress.topicProgress = savedProgress.topicProgress || {};
            savedProgress.topicProgress[currentQuizTopic] = percentage;
            
            // Incrementar temas completados si el puntaje es alto
            if (percentage >= 80) {
                savedProgress.completedTopics = (savedProgress.completedTopics || 0) + 1;
            }
            
            localStorage.setItem('studyProgress', JSON.stringify(savedProgress));
            initializeDashboard();
        }

        function updateTopicProgressFromQuiz(percentage) {
            const savedProgress = JSON.parse(localStorage.getItem('studyProgress') || '{}');
            savedProgress.topicProgress = savedProgress.topicProgress || {};
            savedProgress.topicProgress[currentQuizTopic] = percentage;
            
            localStorage.setItem('studyProgress', JSON.stringify(savedProgress));
            updateTopicProgress();
        }

        function restartQuiz() {
            currentQuestionIndex = 0;
            quizScore = 0;
            selectedOption = -1;
            
            document.getElementById('quiz-container').classList.remove('hidden');
            document.getElementById('quiz-results').classList.add('hidden');
            document.getElementById('current-score').textContent = '0';
            
            loadQuestion();
            document.getElementById('feedback-container').classList.add('hidden');
            document.getElementById('submit-btn').style.display = 'inline-block';
            document.getElementById('next-btn').style.display = 'none';
        }

        function changeQuizTopic() {
            const selector = document.getElementById('quiz-topic');
            currentQuizTopic = selector.value;
            restartQuiz();
        }

        function changeDifficulty() {
            // Implementar filtro por dificultad
            restartQuiz();
        }

        function changeQuestionCount() {
            // Implementar cambio de número de preguntas
            restartQuiz();
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
                
                document.getElementById('feedback-container').classList.add('hidden');
                document.getElementById('submit-btn').style.display = 'inline-block';
                document.getElementById('next-btn').style.display = 'none';
                selectedOption = -1;
            }
        }

        // Funciones del examen
        function initializeExam() {
            const container = document.getElementById('exam-distribution');
            container.innerHTML = '';
            
            topics.forEach(topic => {
                const count = topic.id === 'factorial' || topic.id === 'tri' ? 9 : 8;
                container.innerHTML += `
                    <div class="flex justify-between">
                        <span>${topic.icon} ${topic.name}</span>
                        <span class="font-bold">${count} preguntas</span>
                    </div>
                `;
            });
        }

        function startExam() {
            document.getElementById('exam-start').classList.add('hidden');
            document.getElementById('exam-active').classList.remove('hidden');
            
            examActive = true;
            examQuestionIndex = 0;
            examScore = 0;
            examTime = 3600;
            
            startExamTimer();
            loadExamQuestion();
        }

        function startExamTimer() {
            examTimer = setInterval(() => {
                examTime--;
                
                const minutes = Math.floor(examTime / 60);
                const seconds = examTime % 60;
                document.getElementById('exam-timer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (examTime <= 0) {
                    finishExam();
                }
            }, 1000);
        }

        function loadExamQuestion() {
            // Seleccionar pregunta aleatoria de todos los temas
            const availableTopics = Object.keys(quizData).filter(topic => quizData[topic].length > 0);
            if (availableTopics.length === 0) return;
            
            const randomTopic = availableTopics[Math.floor(Math.random() * availableTopics.length)];
            const topicQuestions = quizData[randomTopic];
            const randomQuestion = topicQuestions[Math.floor(Math.random() * topicQuestions.length)];
            
            // Clonar la pregunta para evitar modificar el original
            const question = JSON.parse(JSON.stringify(randomQuestion));
            
            document.getElementById('exam-question-icon').textContent = question.icon || '🧠';
            document.getElementById('exam-question-number').textContent = examQuestionIndex + 1;
            document.getElementById('exam-question-text').textContent = question.question;
            
            const optionsContainer = document.getElementById('exam-options');
            optionsContainer.innerHTML = '';
            
            if (question.type === 'multiple-choice' && question.options) {
                // Mezclar opciones para el examen
                const shuffledOptions = [...question.options].sort(() => Math.random() - 0.5);
                const originalCorrectIndex = question.correct;
                const correctAnswer = question.options[originalCorrectIndex];
                question.correct = shuffledOptions.indexOf(correctAnswer);
                
                shuffledOptions.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'quiz-option p-4 border rounded-lg cursor-pointer';
                    optionDiv.onclick = () => selectExamOption(index);
                    
                    optionDiv.innerHTML = `
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="exam-option" class="mr-3">
                            <span>${option}</span>
                        </label>
                    `;
                    
                    optionsContainer.appendChild(optionDiv);
                });
            }
            
            const progress = ((examQuestionIndex + 1) / 50) * 100;
            document.getElementById('exam-progress').style.width = progress + '%';
        }

        function selectExamOption(index) {
            document.querySelectorAll('#exam-options .quiz-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            document.querySelectorAll('#exam-options .quiz-option')[index].classList.add('selected');
        }

        function submitExamAnswer() {
            // Calcular puntaje (simulación)
            const isCorrect = Math.random() > 0.3; // 70% de probabilidad de acierto
            if (isCorrect) examScore += 2; // 2 puntos por pregunta correcta
            
            examQuestionIndex++;
            
            if (examQuestionIndex >= 50) {
                finishExam();
                return;
            }
            
            loadExamQuestion();
        }

        function finishExam() {
            clearInterval(examTimer);
            
            document.getElementById('exam-active').classList.add('hidden');
            document.getElementById('exam-results').classList.remove('hidden');
            
            // Calcular resultados
            const percentage = Math.round((examScore / 100) * 100); // Máximo 100 puntos
            const timeUsed = 3600 - examTime;
            const minutes = Math.floor(timeUsed / 60);
            const seconds = timeUsed % 60;
            
            document.getElementById('exam-final-score').textContent = percentage + '%';
            document.getElementById('exam-time-used').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Actualizar estadísticas del dashboard
            const savedProgress = JSON.parse(localStorage.getItem('studyProgress') || '{}');
            const currentMastery = savedProgress.overallMastery || 0;
            const newMastery = Math.min(100, currentMastery + Math.floor(percentage / 5));
            
            savedProgress.overallMastery = newMastery;
            savedProgress.examAttempts = (savedProgress.examAttempts || 0) + 1;
            savedProgress.bestExamScore = Math.max(savedProgress.bestExamScore || 0, percentage);
            
            // Incrementar temas completados si el puntaje es alto
            if (percentage >= 70) {
                savedProgress.completedTopics = Math.min(6, (savedProgress.completedTopics || 0) + 1);
            }
            
            localStorage.setItem('studyProgress', JSON.stringify(savedProgress));
            initializeDashboard();
            
            // Generar desglose por temas
            generateExamBreakdown();
        }

        function generateExamBreakdown() {
            const container = document.getElementById('exam-breakdown');
            const topics = ['tct', 'confiabilidad', 'validez', 'factorial', 'baremacion', 'tri'];
            const topicNames = {
                'tct': 'Teoría Clásica de los Tests',
                'confiabilidad': 'Confiabilidad',
                'validez': 'Validez',
                'factorial': 'Análisis Factorial',
                'baremacion': 'Normalización y Baremación',
                'tri': 'Teoría de Respuesta a los Ítems'
            };
            
            container.innerHTML = '';
            
            topics.forEach(topic => {
                const score = Math.floor(Math.random() * 30) + 70; // Simulación: 70-100%
                const status = score >= 80 ? 'text-green-600' : score >= 60 ? 'text-orange-600' : 'text-red-600';
                
                container.innerHTML += `
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <span class="font-medium">${topicNames[topic]}</span>
                        <span class="font-bold ${status}">${score}%</span>
                    </div>
                `;
            });
        }

        function restartExam() {
            document.getElementById('exam-results').classList.add('hidden');
            document.getElementById('exam-start').classList.remove('hidden');
        }

        function previousExamQuestion() {
            if (examQuestionIndex > 0) {
                examQuestionIndex--;
                loadExamQuestion();
            }
        }

        // Funciones de utilidad
        function setupEventListeners() {
            // Guardar progreso al salir
            window.addEventListener('beforeunload', function() {
                const progress = JSON.parse(localStorage.getItem('studyProgress') || '{}');
                progress.lastVisit = Date.now();
                localStorage.setItem('studyProgress', JSON.stringify(progress));
            });
            
            // Actualizar racha diaria
            updateDailyStreak();
        }

        function updateDailyStreak() {
            const savedProgress = JSON.parse(localStorage.getItem('studyProgress') || '{}');
            const lastVisit = savedProgress.lastVisit || 0;
            const today = new Date().toDateString();
            const lastVisitDate = new Date(lastVisit).toDateString();
            
            if (today !== lastVisitDate) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (lastVisitDate === yesterday.toDateString() || lastVisit === 0) {
                    // Continuar racha
                    savedProgress.currentStreak = (savedProgress.currentStreak || 0) + 1;
                } else {
                    // Reiniciar racha
                    savedProgress.currentStreak = 1;
                }
                
                savedProgress.lastVisit = Date.now();
                savedProgress.studyDays = (savedProgress.studyDays || 0) + 1;
                
                localStorage.setItem('studyProgress', JSON.stringify(savedProgress));
                document.getElementById('current-streak').textContent = savedProgress.currentStreak;
            }
        }

        function loadLandingPage() {
            // Animaciones de entrada
            setTimeout(() => {
                document.querySelectorAll('#landing .card').forEach((card, index) => {
                    card.style.opacity = '0';
                    card.style.transform = 'translateY(20px)';
                    
                    setTimeout(() => {
                        card.style.transition = 'all 0.5s ease';
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                    }, index * 100);
                });
            }, 100);
        }
    </script>
    <script type="module">
        import { showHumor } from './assets/js/humor.js';
        import { renderMiniCaso } from './assets/js/minicaso.js';

        const videoUnitMap = {
            'hriKlRXTF0A': 'tct',
            'aeENe9swI8E': 'confiabilidad',
            'vrU6jJ80_UU': 'validez',
            'v_pD5lwpISI': 'estructura',
            'hl8LNar2oys': 'estandares',
            'BRCeQo9SmSE': 'tri'
        };

        const humorMount = '#prevideo-humor';
        const miniCasoMount = '#mini-caso';

        const setupHumorBehavior = () => {
            const mount = document.querySelector(humorMount);
            const text = mount?.querySelector('.boicoteador')?.innerHTML;
            if (!mount || !text) return;

            mount.innerHTML = `
                <div class="humor-card" role="note" aria-live="polite" aria-label="Nota previa al video">
                    <span class="humor-icon">🤖</span>
                    <div class="humor-text">${text}</div>
                    <button class="humor-close" aria-label="Cerrar aviso">✕</button>
                </div>
            `;

            const closeBanner = () => {
                mount.querySelector('.humor-card')?.remove();
            };

            mount.querySelector('.humor-close')?.addEventListener('click', closeBanner);

            const player = document.getElementById('current-video');
            if (player && player.tagName.toLowerCase() === 'video') {
                player.addEventListener('play', closeBanner, { once: true });
            } else {
                document.querySelector('.youtube-player')?.addEventListener('click', closeBanner, { once: true });
            }
        };

        const showHumorForVideo = (videoId) => {
            const slug = videoUnitMap[videoId] || 'tct';
            showHumor(slug, humorMount).then(setupHumorBehavior);
        };

        const clearMiniCaso = () => {
            const mount = document.querySelector(miniCasoMount);
            if (mount) {
                mount.innerHTML = '';
            }
        };

        const slugMap = {
            factorial: 'estructura',
            baremacion: 'estandares'
        };

        const renderMiniCasoForDeck = (slug) => {
            if (!slug) {
                clearMiniCaso();
                return;
            }
            const mappedSlug = slugMap[slug] || slug;
            renderMiniCaso(mappedSlug, miniCasoMount);
        };

        const originalChangeVideo = window.changeVideo;
        window.changeVideo = function(videoId, title) {
            if (typeof originalChangeVideo === 'function') {
                originalChangeVideo.apply(this, arguments);
            }
            showHumorForVideo(videoId);
        };

        const originalChangeDeck = window.changeDeck;
        window.changeDeck = function() {
            if (typeof originalChangeDeck === 'function') {
                originalChangeDeck.apply(this, arguments);
            }
            const selector = document.getElementById('deck-selector');
            renderMiniCasoForDeck(selector ? selector.value : '');
        };

        document.addEventListener('DOMContentLoaded', () => {
            const iframe = document.getElementById('current-video');
            if (iframe && iframe.src) {
                const parts = iframe.src.split('/');
                const last = parts[parts.length - 1];
                const videoId = last.split('?')[0];
                showHumorForVideo(videoId);
            }

            const selector = document.getElementById('deck-selector');
            if (selector && selector.value) {
                renderMiniCasoForDeck(selector.value);
            } else {
                clearMiniCaso();
            }
        });
    </script>
    <script type="module">
        import { nextStepFor, routesFor } from './assets/js/learning-route.js';
        import { renderNotebookLMSection } from './assets/js/ui-home.js';

        renderNotebookLMSection('#notebooklm');

        const start = document.querySelector('#hero-start');
        if (start) {
            start.onclick = () => {
                const unit = 'tct';
                const step = nextStepFor(unit);
                if (step === 'done') { alert('¡Unidad completada! Elegí otra o repasa.'); return; }
                location.href = routesFor(unit)[step];
            };
        }
    </script>
</body>
</html>
